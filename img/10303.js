(function(){'use strict';var CRC32;!function(){var e,t,n,r,V={function:!0,object:!0},i=V[typeof exports]&&exports&&!exports.nodeType&&exports,k=V[typeof window]&&window||this,o=i&&V[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;function H(e,c){e=e||k.Object(),c=c||k.Object();var l=e.Number||k.Number,s=e.String||k.String,t=e.Object||k.Object,u=e.Date||k.Date,n=e.SyntaxError||k.SyntaxError,T=e.TypeError||k.TypeError,r=e.Math||k.Math,e=e.JSON||k.JSON;"object"==typeof e&&e&&(c.stringify=e.stringify,c.parse=e.parse);var I,S,m,g,y,N,_,f,L,i,w,d,o,C,p,R,U,E,h,v,A,P,a,O,D,b,t=t.prototype,G=t.toString,M=new u(-0xc782b5b800cec);try{M=-109252==M.getUTCFullYear()&&0===M.getUTCMonth()&&1===M.getUTCDate()&&10==M.getUTCHours()&&37==M.getUTCMinutes()&&6==M.getUTCSeconds()&&708==M.getUTCMilliseconds()}catch(e){}function x(e){if(x[e]!==m)return x[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=x("json-stringify")&&x("json-parse");else{var n='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var r=c.stringify,i="function"==typeof r&&M;if(i){(o=function(){return 1}).toJSON=o;try{i="0"===r(0)&&"0"===r(new l)&&'""'==r(new s)&&r(G)===m&&r(m)===m&&r()===m&&"1"===r(o)&&"[1]"==r([o])&&"[null]"==r([m])&&"null"==r(null)&&"[null,null,null]"==r([m,G,null])&&r({a:[o,!0,!1,null,"\0\b\n\f\r\t"]})==n&&"1"===r(null,o)&&"[\n 1,\n 2\n]"==r([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==r(new u(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==r(new u(864e13))&&'"-000001-01-01T00:00:00.000Z"'==r(new u(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==r(new u(-1))}catch(e){i=!1}}t=i}if("json-parse"==e){i=c.parse;if("function"==typeof i)try{if(0===i("0")&&!i(!1)){var o,a=5==(o=i(n)).a.length&&1===o.a[0];if(a){try{a=!i('"\t"')}catch(e){}if(a)try{a=1!==i("01")}catch(e){}if(a)try{a=1!==i("1.")}catch(e){}}}}catch(e){a=!1}t=a}}return x[e]=!!t}return x("json")||(g="[object Function]",y="[object Number]",N="[object String]",_="[object Array]",f=x("bug-string-char-index"),M||(L=r.floor,i=[0,31,59,90,120,151,181,212,243,273,304,334],w=function(e,t){return i[t]+365*(e-1970)+L((e-1969+(t=+(1<t)))/4)-L((e-1901+t)/100)+L((e-1601+t)/400)}),(I=t.hasOwnProperty)||(I=function(e){var n,t={__proto__:null};return t.__proto__={toString:1},I=t.toString!=G?function(e){var t=this.__proto__,e=e in(this.__proto__=null,this);return this.__proto__=t,e}:(n=t.constructor,function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),t=null,I.call(this,e)}),S=function(e,t){var n,a,r,i=0;for(r in(n=function(){this.valueOf=0}).prototype.valueOf=0,a=new n)I.call(a,r)&&i++;return a=null,(S=i?2==i?function(e,t){var n,r={},i=G.call(e)==g;for(n in e)i&&"prototype"==n||I.call(r,n)||!(r[n]=1)||!I.call(e,n)||t(n)}:function(e,t){var n,r,i=G.call(e)==g;for(n in e)i&&"prototype"==n||!I.call(e,n)||(r="constructor"===n)||t(n);(r||I.call(e,n="constructor"))&&t(n)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],function(e,t){var n,r,i=G.call(e)==g,o=!i&&"function"!=typeof e.constructor&&V[typeof e.hasOwnProperty]&&e.hasOwnProperty||I;for(n in e)i&&"prototype"==n||!o.call(e,n)||t(n);for(r=a.length;n=a[--r];o.call(e,n)&&t(n));}))(e,t)},x("json-stringify")||(d={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},o="000000",C=function(e,t){return(o+(t||0)).slice(-e)},p="\\u00",R=function(e){for(var t='"',n=0,r=e.length,i=!f||10<r,o=i&&(f?e.split(""):e);n<r;n++){var a=e.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=d[a];break;default:if(a<32){t+=p+C(2,a.toString(16));break}t+=i?o[n]:e.charAt(n)}}return t+'"'},U=function(e,t,n,r,i,o,a){var c,l,s,u,g,f,d,p,E,h,v,A,P,O;try{c=t[e]}catch(e){}if("object"==typeof c&&c)if("[object Date]"!=(l=G.call(c))||I.call(c,"toJSON"))"function"==typeof c.toJSON&&(l!=y&&l!=N&&l!=_||I.call(c,"toJSON"))&&(c=c.toJSON(e));else if(-1/0<c&&c<1/0){if(w){for(g=L(c/864e5),s=L(g/365.2425)+1970-1;w(s+1,0)<=g;s++);for(u=L((g-w(s,0))/30.42);w(s,u+1)<=g;u++);g=1+g-w(s,u),f=L((E=(c%864e5+864e5)%864e5)/36e5)%24,d=L(E/6e4)%60,p=L(E/1e3)%60,E=E%1e3}else s=c.getUTCFullYear(),u=c.getUTCMonth(),g=c.getUTCDate(),f=c.getUTCHours(),d=c.getUTCMinutes(),p=c.getUTCSeconds(),E=c.getUTCMilliseconds();c=(s<=0||1e4<=s?(s<0?"-":"+")+C(6,s<0?-s:s):C(4,s))+"-"+C(2,u+1)+"-"+C(2,g)+"T"+C(2,f)+":"+C(2,d)+":"+C(2,p)+"."+C(3,E)+"Z"}else c=null;if(null===(c=n?n.call(t,e,c):c))return"null";if("[object Boolean]"==(l=G.call(c)))return""+c;if(l==y)return-1/0<c&&c<1/0?""+c:"null";if(l==N)return R(""+c);if("object"==typeof c){for(P=a.length;P--;)if(a[P]===c)throw T();if(a.push(c),h=[],e=o,o+=i,l==_){for(A=0,P=c.length;A<P;A++)v=U(A,c,n,r,i,o,a),h.push(v===m?"null":v);O=h.length?i?"[\n"+o+h.join(",\n"+o)+"\n"+e+"]":"["+h.join(",")+"]":"[]"}else S(r||c,function(e){var t=U(e,c,n,r,i,o,a);t!==m&&h.push(R(e)+":"+(i?" ":"")+t)}),O=h.length?i?"{\n"+o+h.join(",\n"+o)+"\n"+e+"}":"{"+h.join(",")+"}":"{}";return a.pop(),O}},c.stringify=function(e,t,n){var r,i,o;if(V[typeof t]&&t)if((o=G.call(t))==g)i=t;else if(o==_)for(var a,c={},l=0,s=t.length;l<s;a=t[l++],(o=G.call(a))!=N&&o!=y||(c[a]=1));if(n)if((o=G.call(n))==y){if(0<(n-=n%1))for(r="",10<n&&(n=10);r.length<n;r+=" ");}else o==N&&(r=n.length<=10?n:n.slice(0,10));return U("",((a={})[""]=e,a),i,c,r,"",[])}),x("json-parse")||(E=s.fromCharCode,h={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},P=function(){throw v=A=null,n()},a=function(){for(var e,t,n,r,i,o=A,a=o.length;v<a;)switch(i=o.charCodeAt(v)){case 9:case 10:case 13:case 32:v++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=f?o.charAt(v):o[v],v++,e;case 34:for(e="@",v++;v<a;)if((i=o.charCodeAt(v))<32)P();else if(92==i)switch(i=o.charCodeAt(++v)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=h[i],v++;break;case 117:for(t=++v,n=v+4;v<n;v++)48<=(i=o.charCodeAt(v))&&i<=57||97<=i&&i<=102||65<=i&&i<=70||P();e+=E("0x"+o.slice(t,v));break;default:P()}else{if(34==i)break;for(i=o.charCodeAt(v),t=v;32<=i&&92!=i&&34!=i;)i=o.charCodeAt(++v);e+=o.slice(t,v)}if(34==o.charCodeAt(v))return v++,e;P();default:if(t=v,45==i&&(r=!0,i=o.charCodeAt(++v)),48<=i&&i<=57){for(48==i&&(48<=(i=o.charCodeAt(v+1))&&i<=57)&&P(),r=!1;v<a&&(48<=(i=o.charCodeAt(v))&&i<=57);v++);if(46==o.charCodeAt(v)){for(n=++v;n<a&&(48<=(i=o.charCodeAt(n))&&i<=57);n++);n==v&&P(),v=n}if(101==(i=o.charCodeAt(v))||69==i){for(43!=(i=o.charCodeAt(++v))&&45!=i||v++,n=v;n<a&&(48<=(i=o.charCodeAt(n))&&i<=57);n++);n==v&&P(),v=n}return+o.slice(t,v)}if(r&&P(),"true"==o.slice(v,v+4))return v+=4,!0;if("false"==o.slice(v,v+5))return v+=5,!1;if("null"==o.slice(v,v+4))return v+=4,null;P()}return"$"},O=function(e){var t,n;if("$"==e&&P(),"string"==typeof e){if("@"==(f?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=a());n=n||!0)!n||","==e&&"]"!=(e=a())||P(),","==e&&P(),t.push(O(e));return t}if("{"==e){for(t={};"}"!=(e=a());n=n||!0)!n||","==e&&"}"!=(e=a())||P(),","!=e&&"string"==typeof e&&"@"==(f?e.charAt(0):e[0])&&":"==a()||P(),t[e.slice(1)]=O(a());return t}P()}return e},D=function(e,t,n){n=b(e,t,n);n===m?delete e[t]:e[t]=n},b=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if(G.call(i)==_)for(r=i.length;r--;)D(i,r,n);else S(i,function(e){D(i,e,n)});return n.call(e,t,i)},c.parse=function(e,t){var n;return v=0,A=""+e,n=O(a()),"$"!=a()&&P(),v=A=null,t&&G.call(t)==g?b(((e={})[""]=n,e),"",t):n})),c.runInContext=H,c}!o||o.global!==o&&o.window!==o&&o.self!==o||(k=o),i?H(k,i):(e=k.JSON,t=k.JSON3,n=!1,r=H(k,k.JSON3={noConflict:function(){return n||(n=!0,k.JSON=e,k.JSON3=t,e=t=null),r}}),k.JSON={parse:r.parse,stringify:r.stringify})}.call(this),function(){"use strict";var t=setTimeout;function r(){}function i(e,t){return function(){e.apply(t,arguments)}}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if(typeof e!=="function")throw new TypeError("not a function");this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];g(e,this)}function a(n,r){while(n._state===3)n=n._value;if(n._state===0){n._deferreds.push(r);return}n._handled=true;o._immediateFn(function(){var e=n._state===1?r.onFulfilled:r.onRejected;if(e===null){(n._state===1?c:l)(r.promise,n._value);return}var t;try{t=e(n._value)}catch(e){l(r.promise,e);return}c(r.promise,t)})}function c(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e==="object"||typeof e==="function")){var n=e.then;if(e instanceof o){t._state=3;t._value=e;s(t);return}else if(typeof n==="function"){g(i(n,e),t);return}}t._state=1;t._value=e;s(t)}catch(e){l(t,e)}}function l(e,t){e._state=2;e._value=t;s(e)}function s(e){if(e._state===2&&e._deferreds.length===0)o._immediateFn(function(){if(!e._handled)o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)a(e,e._deferreds[t]);e._deferreds=null}function u(e,t,n){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.promise=n}function g(e,t){var n=false;try{e(function(e){if(n)return;n=true;c(t,e)},function(e){if(n)return;n=true;l(t,e)})}catch(e){if(n)return;n=true;l(t,e)}}o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var n=new this.constructor(r);a(this,new u(e,t,n));return n},o.prototype["finally"]=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})},o.all=function(t){return new o(function(r,i){if(!t||typeof t.length==="undefined")throw new TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(t);if(o.length===0)return r([]);var a=o.length;function c(t,e){try{if(e&&(typeof e==="object"||typeof e==="function")){var n=e.then;if(typeof n==="function"){n.call(e,function(e){c(t,e)},i);return}}o[t]=e;if(--a===0)r(o)}catch(e){i(e)}}for(var e=0;e<o.length;e++)c(e,o[e])})},o.resolve=function(t){if(t&&typeof t==="object"&&t.constructor===o)return t;return new o(function(e){e(t)})},o.reject=function(n){return new o(function(e,t){t(n)})},o.race=function(i){return new o(function(e,t){for(var n=0,r=i.length;n<r;n++)i[n].then(e,t)})},o._immediateFn=typeof setImmediate==="function"&&function(e){setImmediate(e)}||function(e){t(e,0)},o._unhandledRejectionFn=function e(t){if(typeof console!=="undefined"&&console)console.warn("Possible Unhandled Promise Rejection:",t)};var e=function(){if(typeof self!=="undefined")return self;if(typeof window!=="undefined")return window;if(typeof global!=="undefined")return global;throw new Error("unable to locate global object")}();if(!e.Promise)e.Promise=o}(),function(e){"undefined"==typeof DO_NOT_EXPORT_CRC&&"object"==typeof exports?e(exports):e(CRC32={})}(function(e){e.version="1.2.0";var c=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)t[e=n]=e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&e?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1;return"undefined"!=typeof Int32Array?new Int32Array(t):t}();e.table=c,e.bstr=function(e,t){for(var n=-1^t,r=e.length-1,i=0;i<r;)n=(n=n>>>8^c[255&(n^e.charCodeAt(i++))])>>>8^c[255&(n^e.charCodeAt(i++))];return-1^(n=i===r?n>>>8^c[255&(n^e.charCodeAt(i))]:n)},e.buf=function(e,t){if(1e4<e.length)return function(e,t){for(var n=-1^t,r=e.length-7,i=0;i<r;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])];for(;i<7+r;)n=n>>>8^c[255&(n^e[i++])];return-1^n}(e,t);for(var n=-1^t,r=e.length-3,i=0;i<r;)n=(n=(n=(n=n>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])])>>>8^c[255&(n^e[i++])];for(;i<3+r;)n=n>>>8^c[255&(n^e[i++])];return-1^n},e.str=function(e,t){for(var n,r,i=-1^t,o=0,a=e.length;o<a;)i=(n=e.charCodeAt(o++))<128?i>>>8^c[255&(i^n)]:n<2048?(i=i>>>8^c[255&(i^(192|n>>6&31))])>>>8^c[255&(i^(128|63&n))]:55296<=n&&n<57344?(n=64+(1023&n),r=1023&e.charCodeAt(o++),(i=(i=(i=i>>>8^c[255&(i^(240|n>>8&7))])>>>8^c[255&(i^(128|n>>2&63))])>>>8^c[255&(i^(128|r>>6&15|(3&n)<<4))])>>>8^c[255&(i^(128|63&r))]):(i=(i=i>>>8^c[255&(i^(224|n>>12&15))])>>>8^c[255&(i^(128|n>>6&63))])>>>8^c[255&(i^(128|63&n))];return-1^i}});var API_EVENTS={PERSUASIVE_NOTIFICATIONS:"persuasive-notifications",GOAL:"goal",INTEGRATION:"integration"},API_GOAL_TYPES={CLICK:"click",PAGE_VIEW:"page-view"},MATCH_TYPES={DOES_NOT_CONTAIN:"DOES_NOT_CONTAIN",EXCLUDE:"exclude"},APPLICATOR={REMOVED_PLUGIN_PLACEHOLDER:"[[convertize:remove]]",DOM_ELEMENT_ACTION_ATTRIBUTE:"data-cv-action-id",DOM_PLUGIN_SELECTOR:"[plugin]"},DATA={TRIGGER_ID:"data-scenario-trigger-id"},DOM_ACTIONS={INSERT:4,PLUGIN:6,REARRANGE:8},EVENTS={FAILSAFE:"FAILSAFE",BODY_AVAILABLE:"BODY_AVAILABLE",PAGE_LOAD:"PAGE_LOAD",PARTICIPATED:"PARTICIPATED",GOAL_RECORDED:"GOAL_RECORDED",GOALS_RECORDED:"GOALS_RECORDED",API_RESPONSE:"API_RESPONSE",VARIATION_APPLIED:"VARIATION_APPLIED",REQUEST_FAILSAFE:"REQUEST_FAILSAFE",API_PLUGIN_PROCESS:"API_PLUGIN_PROCESS",PROCESS_CLICK:"PROCESS_CLICK",PROCESS_PAGE_VIEW:"PROCESS_PAGE_VIEW",PLUGINS_ANIMATE:"PLUGINS_ANIMATE",HISTORY_REPLACE_STATE:"HISTORY_REPLACE_STATE",HISTORY_PUSH_STATE:"HISTORY_PUSH_STATE",PLUGIN_EVENT_IMPRESSION:"PLUGIN_EVENT_IMPRESSION",PLUGIN_EVENT_HOVER:"PLUGIN_EVENT_HOVER",PLUGIN_EVENT_CLICK:"PLUGIN_EVENT_CLICK",PLUGIN_EVENT_TOUCH:"PLUGIN_EVENT_TOUCH",PLUGIN_EVENT_CLOSE:"PLUGIN_EVENT_CLOSE",PLUGIN_EVENT_SWIPE_START:"PLUGIN_EVENT_SWIPE_START",PLUGIN_EVENT_SWIPE_STOP:"PLUGIN_EVENT_SWIPE_STOP",ECOMMERCE_VARIANT_CHANGE:"ECOMMERCE_VARIANT_CHANGE"},GOAL_TYPE={CLICK:"CLICK",PAGE_VIEW:"PAGE_VIEW"},ORIGINAL={id:0,name:"Original",type:"ORIGINAL"},PLUGIN_TYPES={DRAGNDROP:"dragndrop",DOM:"dom",CONTROLLER:"controller"},QUEUE={REQUEST:"REQUEST_QUEUE"},STATE={EMPTY:"EMPTY",MINIMAL:"MINIMAL",EXPERIMENTS:"EXPERIMENTS",NO_MATCHING:"NO_MATCHING",SPLIT_URL:"SPLIT_URL",AB:"AB",DOM_PLUGINS:"DOM_PLUGINS",ORIGINAL:"ORIGINAL"},STEP={INITIALISATION:"INIT",BRANDING:"BRANDING",PICK_EXPERIMENT:"PICK_EXP",PICK_VARIATION:"PICK_VAR",BODY_AVAILABLE:"BODY_AVAILABLE",PAGE_LOAD:"PAGE_LOAD",VARIATION_APPLIED:"VARIATION_APPLIED",TRACK_VARIATION:"TRACK_VARIATION",TRACK_PAGE_VIEWS:"TRACK_PAGE_VIEWS",NO_MATCHING:"NO_MATCHING",SPLIT_URL:"SPLIT_URL",AB:"AB",DOM_PLUGINS:"DOM_PLUGINS",ORIGINAL:"ORIGINAL"},STRING_POSITION={BEGINNING:"beginning"},UNKNOWN_VARIATION_ID=-1,URLS={APP:"appUrl",PIXEL_API:"pixelApiUrl",LANDING:"landingPageUrl",MEDIA:"mediaUrl",PROXY_PREVIEW:"proxyPreviewUrl"},VARIATION_TYPE={AB:"AB",SPLIT_URL:"SPLIT_URL",ORIGINAL:"ORIGINAL"},VISTOR_TYPE={NEW:"NEW",RETURNING:"RETURNING"},PLATFORM={APP:"app",SHOPIFY:"shopify"},GLOBAL_OPTIONS_VAR={CSS_NODE_ID:"convertize-global-styles",CSS_NODE_SELECTOR:"[global-css]",CSS_NODE:"/html/head",JS_NODE_ID:"convertize-global-script",JS_NODE_SELECTOR:"[global-js]",JS_NODE:"/html/head"},AccountOptions=function(){"use strict";var t={};return{setOptions:function(e){ObjectUtil.isArray(e)&&(e={});t=e},getOptions:function(){return t}}}();function ApiEventsProcessor(e,t,n){"use strict";var r=t(e),i=n(e),o=IntegrationEventProcessor(),a=Logger.getLogger("ApiEventsProcessor");return{add:function(e,t){if(ObjectUtil.isObject(t))switch(e){case API_EVENTS.PERSUASIVE_NOTIFICATIONS:r.add(e,t);break;case API_EVENTS.GOAL:i.add(e,t);break;case API_EVENTS.INTEGRATION:o.add(e,t);break;default:a.log("Event with invalid name. Event not pushed.",e,t)}else a.log("Event with invalid data. Event not pushed.",e,t)},processPlugin:function(e,t){e===API_EVENTS.PERSUASIVE_NOTIFICATIONS&&r.processPersuasiveNotification(e,t)},processUserGoals:function(){i.processGoals()}}}function PixelApi(e){"use strict";var n,r=Logger.getLogger("PixelApi"),e=(n=e,{push:function(e,t){r.log("Incomming data for event",e,t),t.force=t.force||!0,n.add(e,t)}});if(window.convertize&&ObjectUtil.isArray(window.convertize)){for(var t=[],i=0,o=window.convertize.length;i<o;i+=2){for(var a=[],c=0;c<2;c++)a.push(window.convertize[i+c]);t.push(a)}for(r.log("API has been loaded asynchronously"),window.convertize=e,i=0,o=t.length;i<o;i++)window.convertize.push.apply(null,t[i])}else window.convertize=e}function GoalEventProcessor(){"use strict";var n=!1,r=[],i=Logger.getLogger("GoalEventProcessor");return{add:function(e,t){!function(e,t){return!(!e||!t)&&(!!function(e){for(var t in API_GOAL_TYPES)if(API_GOAL_TYPES.hasOwnProperty(t)&&API_GOAL_TYPES[t]===e)return!0;return!1}(t.type)&&function(e){return StringUtils.isString(e)}(t.name))}(e,t)?i.log("Goal with invalid data. Goal not processed"):n?o(t):(i.log("Goal added to queue",t),r.push({name:e,data:t}))},processGoals:function(){i.log("Processing goals",r),n=!0;for(var e=0;e<r.length;e++)o(r[e].data)},_goalsQueue:r};function o(e){e.type===API_GOAL_TYPES.CLICK&&(i.log("Broadcasting process click",e),EventHandler.broadcast(EVENTS.PROCESS_CLICK,e)),e.type===API_GOAL_TYPES.PAGE_VIEW&&(i.log("Broadcasting process page view",e),EventHandler.broadcast(EVENTS.PROCESS_PAGE_VIEW,e))}}function IntegrationEventProcessor(){"use strict";var n=Logger.getLogger("IntegrationEventProcessor");return{add:function(e,t){!function(e,t){return"integration"===e&&IntegrationsTracker.isValidIntegration(t.integration)&&t.action&&"collect"===t.action}(e,t)?n.log("Invalid integration. Action not processed",{integration:e,data:t}):IntegrationsTracker.capture(t.integration)}}}function PersuasiveNotificationsEventProcessor(o){"use strict";var a={},c={};return{add:l,processPersuasiveNotification:function(e,t){c[t.id]=t,s(e,t)},_events:a};function l(e,t){var n,r=!1;for(n in void 0===a[e]&&(a[e]={}),t)t.hasOwnProperty(n)&&(r=!0,ObjectUtil.isObject(t[n])?(a[e][n]=t[n],a[e][n].name=n):a[e][n]={name:n,value:t[n]});if(r||delete a[e],e===API_EVENTS.PERSUASIVE_NOTIFICATIONS)for(var i in c)c.hasOwnProperty(i)&&s(API_EVENTS.PERSUASIVE_NOTIFICATIONS,c[i])}function s(e,t){var n,r=!0,i={};for(n in o.isPreview&&(c={},l(e,t.defaults)),t.defaults)t.defaults.hasOwnProperty(n)&&(a[e]&&a[e][n]?i[n]=a[e][n]:r=!1);r&&(EventHandler.broadcast(EVENTS.API_PLUGIN_PROCESS+"_"+t.id,i),delete c[t.id])}}function AudienceTargeter(n){"use strict";return{matches:function(e){var t=n.length;for(;t--;)if(n[t]&&!n[t].matches(e))return!1;return!0}}}function CookieMatcher(){"use strict";var a=Logger.getLogger("CookieMatcher");return{matches:function(e){if(!e.targeting||!e.targeting.cookie||!e.targeting.cookie.length)return a.log("Matching: OK: no cookie targeting defined"),!0;for(var t,n=e.targeting.cookie,r=0;r<n.length;r++){var i=n[r],o=i.exclude||!1;if(function(e){if(new RegExp("(?:^|;)\\s*"+e+"=").exec(document.cookie))return!0;return!1}(i.key)){if(!i.hasOwnProperty("value")||null===i.value)return t=o?"Not Matching: OK: cookie with no set value":"Matching: OK: cookie with no set value",a.log(t,i),!i.exclude;if(PersistentCookieStorage.get(i.key,!0)===i.value)return t=o?"Not Matching: OK: matched cookie value":"Matching: OK: matched cookie value",a.log("Matching: OK: matched cookie value",i),!i.exclude}}return a.log("Matching: FAILED"),!1}}}function DeviceMatcher(i){"use strict";var o={DESKTOP:"DESKTOP",TABLET:"TABLET",MOBILE:"MOBILE"},a=Logger.getLogger("DeviceMatcher");return{DEVICE:o,matches:function(e){if(!e.targeting||!e.targeting.device||!e.targeting.device.length)return a.log("Matching: OK: no device targeting defined"),!0;var t,n=e.targeting.device,r={};for(t in r[o.DESKTOP]=i.isDesktop(),r[o.TABLET]=i.isTablet(),r[o.MOBILE]=i.isMobile(),r)if(r.hasOwnProperty(t)&&r[t]&&function(e,t){return-1!==e.indexOf(t)}(n,t))return a.log("Matching: OK",t),!0;return a.log("Matching: FAILED",r),!1}}}function IpMatcher(c){"use strict";var l=Logger.getLogger("IpMatcher");function s(e){for(var t=0,n=e.split("."),r=0;r<n.length;r++){var i=+n[r];if(255<i)return null;t+=Math.round(i*Math.pow(2,8*(3-r)))}return t}var e="[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}",o=new RegExp(["^",e,"$"].join("")),a=new RegExp(["^",e,"-",e,"$"].join("")),u=new RegExp(["^",e,"/[0-9]{1,2}$"].join("")),g=new RegExp(["^","[0-9?*]{1,3}\\.[0-9?*]{1,3}\\.[0-9?*]{1,3}\\.[0-9?*]{1,3}","$"].join(""));function f(e){if(o.test(e))return null===(r=s(e))?null:[r,r];if(a.test(e)){var t=s((i=e.split("-"))[0]),n=s(i[1]);return null===t||null===n||n<t?null:[t,n]}if(u.test(e)){var r=s((i=e.split("/"))[0]),i=+i[1];return null===r||32<i?null:[r,Math.floor(r/Math.pow(2,32-i))*Math.pow(2,32-i)+Math.pow(2,32-i)-1]}return g.test(e)?["^",e.replace(/\./g,"\\.").replace(/\?/g,".").replace(/\*/g,".*"),"$"].join(""):null}return{matches:function(e){if(!e.targeting||!e.targeting.ip||!e.targeting.ip.length)return l.log("Matching: OK: no IP targeting defined"),!0;var t=e.targeting.ip,n=c.getIpAddress(),r=s(n);if(null===r)return!1;for(var i=0;i<t.length;i++){var o=t[i].criteria,a=t[i].exclude;if("string"==typeof(o=f(o))){if((o=new RegExp(o)).test(n))return a&&l.log("Matching: OK: excluded IP",n),!a}else if(null!==o&&r>=o[0]&&r<=o[1])return a&&l.log("Matching: OK: excluded IP",n),!a}return!0},ipRangeStringToCriteria:f}}function LanguageMatcher(n){"use strict";var r=Logger.getLogger("LanguageMatcher");return{matches:function(e){if(!e.targeting||!e.targeting.language||!e.targeting.language.length)return r.log("Matching: OK: no language targeting defined"),!0;var t=e.targeting.language,e=n.getBrowserLanguage();return e?-1===t.indexOf(e)?(r.log("Matching: FAILED",t,e),!1):(r.log("Matching: OK",e),!0):(r.log("Matching: FAILED: browser language not provided"),!1)}}}function LocationMatcher(n){"use strict";var r=Logger.getLogger("LocationMatcher");return{matches:function(e){if(!e.targeting||!e.targeting["geo-location"]||!e.targeting["geo-location"].length)return r.log("Matching: OK: no location targeting defined"),!0;var t=e.targeting["geo-location"],e=n.getCountry();return e?-1===t.indexOf(e)?(r.log("Matching: FAILED",t,e),!1):(r.log("Matching: OK",e),!0):(r.log("Matching: FAILED: client country not provided"),!1)}}}function QueryMatcher(){"use strict";var a=Logger.getLogger("QueryMatcher");return{matches:function(e){if(!e.targeting||!e.targeting["url-query-parameters"]||!e.targeting["url-query-parameters"].length)return a.log("Matching: OK: no query targeting defined"),!0;var t=e.targeting["url-query-parameters"],n=WindowUtil.getQueryParameters(),r=t.length;for(;r--;){var i=t[r];if(!n.hasOwnProperty(i.key))return a.log("Matching: FAILED: key not found",i),!1;var o=n[i.key];if(o!==i.value&&null!==i.value&&void 0!==i.value)return a.log("Matching: FAILED: value not matching",i,o),!1}return a.log("Matching: OK"),!0}}}function ReferralMatcher(){"use strict";var o=Logger.getLogger("ReferralMatcher");return{matches:function(e){if(!e.targeting||!e.targeting.referrer||!e.targeting.referrer.length)return o.log("Matching: OK: no referral targeting defined"),!0;var t=WindowUtil.getDocumentReferrer(),n=e.targeting.referrer,r=n.length;for(;r--;){var i=n[r];try{if(new RegExp(i.pattern,"i").test(t))return o.log("Matching: OK",t,i),!0}catch(e){console.error(e)}}return o.log("Matching: FAILED",t),!1}}}function ScheduleMatcher(){"use strict";var i=Logger.getLogger("ScheduleMatcher");return{matches:function(e){if(!e.targeting||!e.targeting.time||!e.targeting.time.length)return i.log("Matching: OK: no time targeting defined"),!0;var t=function(){var e=new Date;return{day:e.getDay(),time:o(e.getHours())+":"+o(e.getMinutes())}}(),n=e.targeting.time,r=n.length;for(;r--;)if(function(e,t){if(t.days&&t.days.length&&-1===t.days.indexOf(e.day))return!1;{if(!t.from&&!t.to)return!0;if(t.to){if(t.from){if(t.from>=t.to){if(t.from<=e.time||e.time<t.to)return!0}else if(t.from<=e.time&&e.time<t.to)return!0}else if(t.to>e.time)return!0}else if(t.from<=e.time)return!0}return!1}(t,n[r]))return i.log("Matching: OK",n[r]),!0;return i.log("Matching: FAILED"),!1}};function o(e){return("0"+e).slice(-2)}}function UrlMatcher(a){"use strict";var c=Logger.getLogger("UrlMatcher"),l=UrlService.getUrlByName(URLS.PROXY_PREVIEW);return{matches:function(e,t){if(!e.url_targeting||!e.url_targeting.rules||!e.url_targeting.rules.length)return t||c.log("Matching: FAILED: no url targeting defined"),!1;var n=e.url_targeting.rules,r=n.length;for(;r--;){var i=n[r];if(!0===RegexUtil.testUrl(i,a,l))return t||c.log("Matching: OK",WindowUtil.getActualLocationHref()),!0}t||c.log("Matching: FAILED",WindowUtil.getActualLocationHref());return!1},matchesAll:function(e,t){if(!e.url_targeting||!e.url_targeting.rules||!e.url_targeting.rules.length)return t||c.log("Matching: FAILED: no url targeting defined"),!1;var e=e.url_targeting.rules,n=e.filter(function(e){return e.rule===MATCH_TYPES.EXCLUDE}),r=n.length;for(;r--;)if(!0===RegexUtil.testUrl(n[r],a,l))return t||c.log("Matching: FAILED: URL is excluded",WindowUtil.getActualLocationHref()),!1;var i=e.filter(function(e){return e.rule!==MATCH_TYPES.EXCLUDE}),o=i.length;for(;o--;)if(!0===RegexUtil.testUrl(i[o],a,l))return t||c.log("Matching: OK: URL is included",WindowUtil.getActualLocationHref()),!0;t||c.log("Matching: FAILED",WindowUtil.getActualLocationHref());return!1}}}function VisitorMatcher(n){"use strict";var r=VISTOR_TYPE,i=Logger.getLogger("VisitorMatcher");return{matches:function(e){if(!e.targeting||!e.targeting.visit||!e.targeting.visit.length)return i.log("Matching: OK: no visitors targeting defined"),!0;var t=n.isNewVisitor()?r.NEW:r.RETURNING,e=e.targeting.visit;return-1!==e.indexOf(t)?(i.log("Matching: OK",e,t),!0):(i.log("Matching: FAILED",e,t),!1)}}}function Branding(e,t){var n={CONTAINER:"scenario-pixel",IMAGE:"scenario-image",SPAN:"scenario-span",ANIMATION:"bounce"},r={"line-height":"normal",display:"block",position:"fixed",bottom:"0",left:"30px",margin:"0",padding:"5px 10px","box-sizing":"border-box","background-color":"#4e4e4e",opacity:"0.4",color:"#a7a9ae","border-radius":"3px 3px 0 0","font-size":"11px","font-family":"'Proxima Nova', Arial, sans-serif",cursor:"pointer","text-decoration":"none","z-index":"2147483647"},i={color:"#898989","background-color":"#3C3C3C"},o={"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","line-height":"normal",display:"inline",position:"relative",margin:"0",padding:"0","box-sizing":"border-box","vertical-align":"bottom"},a={"line-height":"normal",display:"inline-block",position:"relative",margin:"0",padding:"0","padding-left":"5px","box-sizing":"border-box","vertical-align":"middle",width:"74px",height:"15px"},c={};c["@keyframes "+n.ANIMATION]={"0%, 50%":{transform:"translateY(30px)","-moz-transform":"translateY(30px)","-webkit-transform":"translateY(30px)","-ms-transform":"translateY(30px)"},"65%, 80%, 100%":{transform:"translateY(0)","-moz-transform":"translateY(0)","-webkit-transform":"translateY(0)","-ms-transform":"translateY(0)"},"60%":{transform:"translateY(-30px)","-moz-transform":"translateY(-30px)","-webkit-transform":"translateY(-30px)","-ms-transform":"translateY(-30px)"},"70%":{transform:"translateY(-15px)","-moz-transform":"translateY(-15px)","-webkit-transform":"translateY(-15px)","-ms-transform":"translateY(-15px)"}},c["#"+n.CONTAINER]={animation:"bounce 4s 1"};var l,s,u,g=data.branding,f="";return Object.keys||(Object.keys=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n}),{draw:function(){data.branding&&(l=d(n.CONTAINER),s=d(n.IMAGE,"img"),u=d(n.SPAN,"span"),s.src=e+"images/convertize_logo_white.svg?v="+t,s.alt="Convertize",u.innerHTML="Optimised by",l.onmouseover=p,l.onmouseout=E,l.onclick=h,v(l,r),v(u,o),v(s,a),l.appendChild(u),l.appendChild(s),document.body.appendChild(l),function(e,t){e=function(e,t){return e["@-moz-keyframes "+t]=e["@keyframes "+n.ANIMATION],e["@-webkit-keyframes "+t]=e["@keyframes "+n.ANIMATION],e}(e,t),f=function e(t){var n=Object.keys(t);for(var r=0;r<n.length;r++){var i=n[r],o=t[i];"string"==typeof o?f+=i+": "+o+";":"object"==typeof o&&(f+=i+"{",e(o)),r==n.length-1&&(f+="}")}return f}(e);t=document.getElementsByTagName("head")[0],e=document.createElement("style");e.setAttribute("type","text/css"),e.styleSheet?e.styleSheet.cssText=f:e.appendChild(document.createTextNode(f));t.appendChild(e)}(c,n.ANIMATION))}};function d(e,t){t=t||"div";t=document.createElement(t);return t.id=e,t}function p(e){e.preventDefault(),v(l,i)}function E(e){e.preventDefault(),v(l,r)}function h(e){e.preventDefault(),window.open(g,"_blank").focus()}function v(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r];e.style[i]=t[i]}}}function ClientData(t){var n="!%";return{getBrowserLanguage:function(){var e=t.getBrowserLanguage();return!e||StringUtils.startsWith(e,n)?null:e.substring(0,2)},isDesktop:function(){return"true"===t.isDesktop()},isTablet:function(){return"true"===t.isTablet()},isMobile:function(){return"true"===t.isMobile()},getCountry:function(){var e=t.getCountry();return!e||StringUtils.startsWith(e,n)?null:e},getCountryName:function(){var e=t.getCountryName();return!e||StringUtils.startsWith(e,n)?null:e},getCityName:function(){var e=t.getCityName();return e&&!StringUtils.startsWith(e,n)&&"unknown"!==StringUtils.toLowercase(e)?e:null},isInitialised:function(){for(var e in t)if(t.hasOwnProperty(e)){e=t[e]();if(StringUtils.startsWith(e,n))return!1}return!0},getIpAddress:function(){var e=t.getIpAddress();return!e||StringUtils.startsWith(e,n)?null:e}}}var RawClientData=function(){var t="fr",n={desktop:"true",tablet:"false",mobile:"false"},r="GA",i="Gabon",o="Libreville",a="41.158.150.216";return{getBrowserLanguage:function(){return t},getDevices:function(){var e,t=[];for(e in n)"true"===n[e]&&t.push(e);return t.length?t:null},isDesktop:function(){return n.desktop},isTablet:function(){return n.tablet},isMobile:function(){return n.mobile},getCountry:function(){return r},getCountryName:function(){return i},getCityName:function(){return o},getIpAddress:function(){return a},load:function(e){e.hasOwnProperty("browser_language")&&(t=e.browser_language);e.hasOwnProperty("country_code")&&(r=e.country_code);e.hasOwnProperty("country_name")&&(i=e.country_name);e.hasOwnProperty("city_name")&&(o=e.city_name);e.hasOwnProperty("ip_address")&&(a=e.ip_address);e.hasOwnProperty("devices")&&(n=e.devices)}}}(),EventHandler=function(){"use strict";var i={},o=!1,r={BODY_AVAILABLE:!1,PAGE_LOAD:!1};return{on:function(e,t){var n={callback:t,removed:!1};i[e]?0<=i[e].indexOf(t)||i[e].push(n):i[e]=[n]},detach:function(e,t){if(e&&(o=!0,i[e]))for(var n=0,r=i[e].length;n<r;n++)if(i[e][n].callback===t)return void(i[e][n].removed=!0)},broadcast:function(e,t){if(i[e]){if(e in r){if(r[e])return;r[e]=!0}o=!1;for(var n=0;n<i[e].length;n++)i[e][n].removed||i[e][n].callback(t);o&&function(e){if(i[e])for(var t=i[e].length-1;0<=t;t--)i[e][t].removed&&i[e].splice(t,1)}(e)}},_events:i}}();function ClickGoalHandler(n,r,i,o,a){"use strict";var c=Logger.getLogger("ClickGoalHandler"),l=QueueManager.getInstanceByName(QUEUE.REQUEST),s={},u=[];return{init:function(){(function(){if(n&&n.goals&&n.goals.length)for(var e=n.goals.length;e--;){var t=n.goals[e];GOAL_TYPE.CLICK===t.type&&function(e){return!e.dynamic||0<e.variationId&&e.variationId===a.id}(t)&&function(e){var t;c.log("Initialising trigger...",e),(s[e.id]=e).dynamic?(u.push(e),c.log("Initialising trigger: SKIPPING: Dynamic",e)):(t=NodeSelectorUtil.getNodeBySelector(e.selector))?(t.setAttribute(DATA.TRIGGER_ID,e.id),c.log("Initialising trigger: OK",e)):c.log("Initialising trigger: FAILED: Element not found")}(t)}})(),EventHandler.on(EVENTS.PROCESS_CLICK,function(e){g(e)})},handle:function(){for(var e in function(){for(var e=0,t=u.length;e<t;e++)!function(e){var t;c.log("Initialising dynamic trigger...",e),s[e.id]=e,t=NodeSelectorUtil.isDynamicSelector(e.selector)?NodeSelectorUtil.getNodeBySelector(e.selector):XPathUtil.getNodeByXPath(e.selector);t?(t.setAttribute(DATA.TRIGGER_ID,e.id),c.log("Initialising dynamic trigger: OK",e)):c.log("Initialising dynamic trigger: FAILED: Element not found")}(u[e])}(),c.log("Handling...",s),s)if(s.hasOwnProperty(e)){var t=s[e];try{var n=document.querySelectorAll("["+DATA.TRIGGER_ID+'="'+t.id+'"]');c.log("Handling trigger...",t,n);for(var r=n.length;r--;)!function(e,t){e.addEventListener("click",function(e){g(t)},!1),c.log("Handling trigger:OK",t,e)}(n[r],t)}catch(e){c.log("Handling: ERROR",e,t)}}},getTriggers:function(){return s}};function g(e){try{var t=function(e){var t,n=[];for(t in s){var r;s.hasOwnProperty(t)&&(r=s[t],StringUtils.toLowercase(e.name)===StringUtils.toLowercase(r.name)&&(o?n.push(r.name):n.push(r.id)))}return n}(e);if(!t||0===t.length)return void c.log("No click goals found under trigger",e);l.addToQueue({callback:f,data:{goals:t,goalType:GOAL_TYPE.CLICK}})}catch(e){c.log("Recording click goal: ERROR",e),i.recordError(e,STEP.TRACK_GOALS)}}function f(e,t){r.record(e.goals,e.goalType),EventHandler.on(EVENTS.GOAL_RECORDED,function e(){"function"==typeof t&&(t(),EventHandler.detach(EVENTS.GOAL_RECORDED,e))})}}function GoalRecorder(i){"use strict";var o={};o[GOAL_TYPE.CLICK]=1,o[GOAL_TYPE.PAGE_VIEW]=2;var a=null,c=null;return{record:function(e,t,n,r){void 0===n&&(n=a?a.id:null);void 0===r&&(r=c?c.id:UNKNOWN_VARIATION_ID);e=e.join(),i.recordGoal({id:e,type:o[t]},n,r)},setExperiment:function(e){a=e},setVariation:function(e){c=e}}}function PageViewGoalHandler(o,i,a){"use strict";var r,c=Logger.getLogger("PageViewGoalHandler"),t=UrlService.getUrlByName(URLS.PROXY_PREVIEW),l=QueueManager.getInstanceByName(QUEUE.REQUEST),s=[],u={};return d(),function(){for(var e in o)if(o.hasOwnProperty(e)){var t=o[e],n=!1;if(t.goals&&t.goals.length){u[e]=[];for(var r=t.goals.length;r--;){var i=t.goals[r];GOAL_TYPE.PAGE_VIEW===i.type&&(n=!0,function(e,t){s.push(e),a?u[t].push(e.name):u[t].push(e.id)}(i,e))}n||delete u[e]}}}(),function(){var e,t=!1;for(e in u)u.hasOwnProperty(e)&&0<p(u[e]).length&&(t=!0);t?EventHandler.on(EVENTS.GOAL_RECORDED,function e(){c.log("All Page View Goals recorded."),EventHandler.detach(EVENTS.GOAL_RECORDED,e),EventHandler.broadcast(EVENTS.GOALS_RECORDED)}):(c.log("No Page View Goals to record."),EventHandler.broadcast(EVENTS.GOALS_RECORDED))}(),EventHandler.on(EVENTS.PROCESS_PAGE_VIEW,function(e){var t=function(e){for(var t=[],n=0;n<s.length;n++)StringUtils.toLowercase(s[n].name)===StringUtils.toLowercase(e.name)&&t.push(s[n]);return t}(e);if(t&&0!==t.length)for(var n=0;n<t.length;n++){var r,i=t[n];for(r in u)u.hasOwnProperty(r)&&-1<u[r].indexOf(i.id)&&g([i.id],r,e.force||!1)}else c.log("Could not find page view goal",e)}),{handle:function(){0===s.length&&EventHandler.broadcast(EVENTS.GOALS_RECORDED);for(var e in c.log("Handling...",s,r),u)u.hasOwnProperty(e)&&g(u[e],e)},getGoals:function(){return s},_testGoal:E};function g(e,t,n){c.log("Queueing page view goals",e,t,n),t=isNaN(parseInt(t,10))?t:parseInt(t,10),0!==(e=p(e,n)).length&&l.addToQueue({callback:f,data:{goals:e,goalType:GOAL_TYPE.PAGE_VIEW,experimentId:t,currentUrl:r}})}function f(e,t){c.log("Tracking page view goals",e),function(t,e,n,r){try{i.record(t,e,n,UNKNOWN_VARIATION_ID)}catch(e){c.log("Handling: ERROR",e,t,r)}}(e.goals,e.goalType,e.experimentId,e.currentUrl),EventHandler.on(EVENTS.GOAL_RECORDED,function e(){"function"==typeof t&&(t(),EventHandler.detach(EVENTS.GOAL_RECORDED,e))})}function d(){r=WindowUtil.getLocationHref(),a&&(r=StringUtils.removeFromString(t,r,STRING_POSITION.BEGINNING))}function p(e,t){d();for(var n=[],r=0,i=e.length;r<i;r++){var o=function(e){for(var t=0,n=s.length;t<n;t++){if(!a&&s[t].id===e)return s[t];if(a&&s[t].name===e)return s[t]}}(e[r]);!0!==t?E(o)?n.push(e[r]):c.log("Goal pattern does not match current url",o):n.push(e[r])}return n}function E(e){return RegexUtil.testUrl(e.options,a,t)}}function PreviewGoalRecorder(){"use strict";return{record:function(e,t){t===GOAL_TYPE.CLICK?WindowUtil.alert("Goal "+e[0]+" triggered."):WindowUtil.alert("Goals: "+e.join(", ")+" triggered.");setTimeout(function(){EventHandler.broadcast(EVENTS.GOAL_RECORDED)},50)},setExperiment:function(e){0},setVariation:function(e){0}}}function ConsoleLogger(t){"use strict";return Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call),{log:function(){var e;!window.console||"undefined"!=typeof console&&"object"==typeof console.log||((e=Array.prototype.slice.call(arguments)).unshift(t),window.console.log.apply(window.console,e))}}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0==i)return-1;t=+t||0;if(i<=(t=Math.abs(t)===1/0?0:t))return-1;for(n=Math.max(0<=t?t:i-Math.abs(t),0);n<i;){if(n in r&&r[n]===e)return n;n++}return-1});var Logger=function(){"use strict";var t=!1;return{isDebug:function(){return t},setDebug:function(e){t="true"===TransientStorage.getInstance().get("convertizedebug")||!!e},getLogger:function(e){if(t)return ConsoleLogger(e);return NullLogger()}}}();function NullLogger(){"use strict";return{log:function(){}}}function ModeDecorator(){"use strict";var e=UrlService.getUrlByName(URLS.APP),n=(e=e,-1!==WindowUtil.getActualLocationHref().indexOf(e));return{getClass:function(e,t){return n&&void 0!==t?t:e},isPreview:n}}function ExperimentPicker(o,a){"use strict";var c=Logger.getLogger("ExperimentPicker");return{pick:function(e){if(!e)return c.log("Picking: FAILED: No experiments provided"),null;var t,n=[];for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(o.matches(r)){if(a&&a.getParticipationForExperiment(r.id))return c.log("Picking: OK: Found previously participated experiment",r),r;n.push(r)}}if(0===n.length)return c.log("Picking: FAILED: No eligible experiments"),null;var i=n[Math.floor(Math.random()*n.length)];return c.log("Picking: OK: Randomly picked experiment",i),i}}}function VariationPicker(s){"use strict";var u=Logger.getLogger("VariationPicker");return{pick:function(e){if(!e||!e.variations||!e.variations.length)return u.log("Picking: FAILED: No variations to pick from"),ORIGINAL;var t=e.variations,n=!!s&&s.getParticipationForExperiment(e.id);if(n){var r=function(e){if(!e.length)return!0;var t=e.length,n=100;for(;t--;)n-=e[t].allocation;return 0<n}(t),e=function(e){return e===ORIGINAL.id}(n.variation_id);if(e&&r)return u.log("Picking: OK: Previously participating to original"),ORIGINAL;if(e&&!r)u.log("Picking...: Could not find previously participated variation",n);else{for(var i=t.length;i--;){var o=t[i];if(n.variation_id===o.id)return u.log("Picking: OK: Previously participating to variation",o),o}u.log("Picking...: Could not find previously participated variation",n)}}var a=Math.round(99*Math.random())+1,c=t.length;for(;c--;){var l=t[c];if(a<=l.allocation)return u.log("Picking: OK: Picked variation",l),l;a-=l.allocation||0}return u.log("Picking: OK: Picked original variation"),ORIGINAL}}}var PixelInfo=function(){var t={getStandardBrandingText:function(){return t._standardBrandingText},setStandardBrandingText:function(e){t._standardBrandingText=e},getCustomBrandingText:function(){return t._customBrandingText},setCustomBrandingText:function(e){t._customBrandingText=e},getForceBranding:function(){return t._forceBranding},setForceBranding:function(e){t._forceBranding=e},_standardBrandingText:void 0,_customBrandingText:void 0,_forceBranding:!1};return t}(),AnimationsSwipe=function(r,i){"use strict";var t=null,n=null,o=!1,a=u(r.style.left),c=r.style.transition,l=r.offsetWidth/2;function s(e){return e.changedTouches?e.changedTouches[0]:e}function u(e){return e?parseInt(e.replace("px"),10):0}DOMUtils.addEventListener(r,"touchstart",function(e){o=!0,t=s(e).clientX,r.style.transition=c,EventHandler.broadcast(EVENTS.PLUGIN_EVENT_SWIPE_START)}),DOMUtils.addEventListener(r,"touchmove",function(e){o&&(e.preventDefault(),n=s(e).clientX-t,r.style.left=a+n+"px",Math.abs(n)>=l&&(o=!1,function(t){r.style.opacity=1;var n=u(r.style.left);!function e(){n+="left"===t?-10:10,r.style.opacity-=.1,r.style.left=n+"px",r.style.opacity<=0?(r.style.display="none",i()):requestAnimationFrame(e)}()}(n<0?"left":"right")))}),DOMUtils.addEventListener(r,"touchend",function(){o&&(Math.abs(n)<l&&(r.style.transition="all 500ms",r.style.left="0px"),a=u(r.style.left),o=!1,EventHandler.broadcast(EVENTS.PLUGIN_EVENT_SWIPE_STOP))})},AnimationsTimeline=function(t,n,r,i,e){"use strict";var o,a,c,l,s={FADE_IN:"fade-in",SLIDE_IN:"slide-in"},u=.75,g={initial:3e3,wait:5e3,wait_increase:0,show:6e3,animate:500},f={SLIDE_IN:{topRight:"sc-slide-right",topLeft:"sc-slide-left",bottomRight:"sc-slide-bottom",bottomLeft:"sc-slide-bottom",center:"sc-slide-top"},FADE_IN:"sc-fade"},d=!1,p=!1,E=!1,h=!1,v=!0,A=0;if(null!==e)for(var P in e)g[P]=e[P];return{start:function(e){d||(h=e,d=!0,o=Logger.getLogger("AnimationsTimeline"),e?o.log("Timeline started with accelerated mode enabled"):o.log("Timeline started with accelerated mode disable"),setTimeout(I,O("initial")),EventHandler.on(EVENTS.PLUGIN_EVENT_SWIPE_START,_),EventHandler.on(EVENTS.PLUGIN_EVENT_SWIPE_STOP,L))},stop:function(){p||(E=!(A=0))},skipToNextItem:function(){l&&(c&&clearInterval(c),N(l.node),S(l.node))},restart:function(){(E||p)&&(!E||p?(o.log("Timeline restarted"),E=p=!1,T()):E=!1)},_getTiming:O};function O(e){e=g[e];return h?e*u:e}function T(){o.log("Next pick scheduled"),p||E||a||(a=setTimeout(I,O("wait")+O("wait_increase")*A))}function I(){if((l=t())&&l.node){var e=l.configuration.hasOwnProperty("persistent")&&l.configuration.persistent;o.log("Animating element",l.node),o.log("Element is",e?"persistent":"not persistent"),y(l.node),e||(c=setTimeout(function(){N(l.node),S(l.node)},O("show"))),v&&(v=!1,EventHandler.broadcast(EVENTS.PLUGINS_ANIMATE))}else{if(a=null,E)return o.log("Timeline stopped"),void(p=!(E=!1));o.log("No item to animate. Waiting..."),T()}}function S(e){setTimeout(function(){DOMUtils.removeElement(e),y(e),l=a=null,E?(p=!0,o.log("Timeline stopped")):T(),p?A=0:A++,JSUtils.callCallback(n)},O("animate"))}function m(e,t){return e===s.SLIDE_IN?f.SLIDE_IN[t]:f.FADE_IN}function y(e){var t=m(r,i);DOMUtils.removeClass(e,t+"-out"),DOMUtils.addClass(e,t+"-in"),AnimationsSwipe(e,T)}function N(e){var t=m(r,i);DOMUtils.removeClass(e,t+"-in"),DOMUtils.addClass(e,t+"-out")}function _(){l&&(c&&clearInterval(c),o.log("Paused the animateOut timeline..."))}function L(){l&&(l.configuration.hasOwnProperty("persistent")&&l.configuration.persistent||(c=setTimeout(function(){N(l.node),S(l.node)},O("show"))),o.log("Resuming the animateOut timeline..."))}},PluginsApi=function(){"use strict";var o,a,c=[];return{setBaseUrl:function(e){o=e},setPlatform:function(e){a=e},getPlatform:function(){return a},post:function(e,t,n,r){var i=o+e;!t.hasOwnProperty("platform")&&a&&(t.platform=a);l().log("Sending POST request...",i,t);t=XHRUtil.post(i,t,"json");c.push(t.request),t.promise.then(function(e){l().log("Server response OK",i,e),JSUtils.callCallback(n,[e])},function(){l().log("Server response FAILED",i),JSUtils.callCallback(r)})},cancelAll:function(){for(var e=0,t=c.length;e<t;e++){var n=c[e];XHRUtil.isDone(n)||n.abort()}}};function l(){return Logger.getLogger("PluginsApi")}}(),PluginsData=function(){"use strict";var n=!1;return{registerProvider:function(e){if(JSUtils.isFunction(e))return n=e.call();throw"Invalid data provider."},unregisterProvider:function(){n=!1},get:function(e){if(!n)throw"Plugins data provider is not registered.";if(!e)throw"Missing method name.";var t=Array.apply(null,arguments).slice(1),e="get"+e[0].toUpperCase()+e.substr(1);if(n.hasOwnProperty(e)&&JSUtils.isFunction(n[e]))return n[e].apply(null,t);throw'Method "'+e+'" does not exist in the provider.'}}}(),PluginsDisplay=function(){"use strict";var c,t,n,e,l,s,u=[],g={},f=!1,r=ClientData(RawClientData),d=3,p={topRight:{position:"fixed",top:"30px",right:"30px",zIndex:2147483645},topLeft:{position:"fixed",top:"30px",left:"30px",zIndex:2147483645},bottomRight:{position:"fixed",bottom:"30px",right:"30px",zIndex:2147483645},bottomLeft:{position:"fixed",bottom:"30px",left:"30px",zIndex:2147483645},center:{position:"fixed",top:"calc(50% - 32px)",left:"0",right:"0",zIndex:2147483645}},E={container:"ve-container-box",closeButton:"convertize-close",closeButtonVisible:"convertize-close-visible",withBranding:"convertize-with-branding"},h={WAITING:0,READY:1,PICKED:2};return{prepareOptions:function(){e=PluginsHelper.getNotificationsOptions(),t=e.hasOwnProperty("animation")?e.animation:"fade-in",n=e.hasOwnProperty("timings")?e.timings:null,s=!!e.hasOwnProperty("showClose")&&e.showClose},repositionContainer:function(e){for(var t in e)e.hasOwnProperty(t)&&(p[v()][t]=e[t])},addPlugin:function(e,t){var n=e.name,r=e.id,i=PluginsManager.getPluginDefinition(n),o=!1,a=n+":"+r,n=h.WAITING;g.hasOwnProperty(a)&&((r=g[a])===h.PICKED?g[a]=n:n=r);i.hasOwnProperty("useNotificationsOptions")&&i.useNotificationsOptions&&(o=function(e){return e.type===PLUGIN_TYPES.DOM&&function(e){if(!p.hasOwnProperty(e))return!1;var t="ve-plugins-container-"+e,n=document.getElementById(t);if(n)return n;var r,i=document.createElement("div"),o=p[e];PluginsHelper.getIsBrandingAdded()&&o.bottom&&(i.className=E.withBranding+" ");for(r in i.id=t,i.className+=E.container,o)o.hasOwnProperty(r)&&(i.style[r]=o[r]);return document.body.appendChild(i),i}(v())}(i));(function(e){e.configuration.hasOwnProperty("instances")||(e.configuration.instances=1);for(var t=0,n=u.length;t<n;t++)if(P(u[t].configuration,e.configuration))return u[t]=e;u.push(e)})({configuration:e,node:t,containerNode:o,state:n,retries:0}),l&&P(l.configuration,e)&&c.skipToNextItem();c&&c.restart()},showPlugins:function(e){f=!!e,(c=new AnimationsTimeline(O,i,t,v(),n)).start(PluginsHelper.getAcceleratedMode())},setPluginReadyState:function(e){A(e,h.READY)},cancelPlugin:function(e,t){for(var n=0;n<u.length;n++)if(u[n].configuration.name===e&&u[n].configuration.id===t){u.splice(n,1);break}},getPluginsPosition:v,clear:function(){u=[],g={},c.stop()},skipToNextItem:function(){c&&c.skipToNextItem()},_plugins:u};function v(){return!r.isTablet()&&r.isMobile()?e.hasOwnProperty("mobile_position")?e.mobile_position:"topRight":e.hasOwnProperty("position")?e.position:"topRight"}function A(e,t){var n=e.name,r=e.id;g[n+":"+r]=t;for(var i=0;i<u.length;i++)if(u[i].configuration.name===e.name&&u[i].configuration.id===e.id){u[i].state=t;break}}function P(e,t){var n=e.name,r=e.id,e=t.name,t=t.id;return n===e&&r===t}function O(){if(0===u.length)return!1;var e,t,n,r,i=u.shift(),o=i.node,a=!1;if(i.state===h.READY&&o.dataset&&o.dataset.hasOwnProperty("noDisplay")&&(a=!0),i.state===h.PICKED&&f)return DOMUtils.insertElement(o,i.containerNode,"prepend"),u.push(i),i.node;if(i.state===h.READY&&!a)return DOMUtils.insertElement(o,i.containerNode,"prepend"),n=o,r=I(i),DOMUtils.addEventListener(n,"animationend",function(){EventHandler.broadcast(EVENTS.PLUGIN_EVENT_IMPRESSION,r)}),DOMUtils.addEventListener(n,"click",function(){EventHandler.broadcast(EVENTS.PLUGIN_EVENT_CLICK,r)}),DOMUtils.addEventListener(n,"touchend",function(){S(n),EventHandler.broadcast(EVENTS.PLUGIN_EVENT_TOUCH,r)}),DOMUtils.addEventListener(n,"mouseenter",function(){S(n),EventHandler.broadcast(EVENTS.PLUGIN_EVENT_HOVER,r)}),DOMUtils.addEventListener(n,"mouseleave",function(){DOMUtils.removeClass(n,E.closeButtonVisible)}),e=i,o=(o=o).querySelectorAll("."+E.closeButton),s?0!==o.length&&((o=o[0]).innerHTML="x",t=I(e),DOMUtils.addEventListener(o,"click",function(e){c.skipToNextItem(),EventHandler.broadcast(EVENTS.PLUGIN_EVENT_CLOSE,t),e.stopPropagation()})):o[0].remove(),A(i.configuration,h.PICKED),(l=i).configuration.instances--,!1===f&&0<i.configuration.instances&&PluginsManager.requeuePlugin(i.configuration),T(i),i;if(!a&&i.retries<=d)i.retries++,u.push(i);else if(!T(i))return!1;return!!function(){for(var e=0,t=u.length;e<t;e++){var n=u[e],r=n.node;if((n.state===h.READY||n.state===h.PICKED&&f)&&(n.state!==h.READY||!r.dataset||!r.dataset.hasOwnProperty("noDisplay")))return!0}return!1}()&&O()}function T(e){return f?(e.configuration.instances=1,PluginsManager.requeuePlugin(e.configuration),1):0!==u.length||(c.stop(),void(f||PluginsApi.cancelAll()))}function i(){l=null}function I(e){var t={plugin:{name:e.configuration.name},config:{id:e.configuration.configId}},e=ObjectUtil.getObjectProperty(e.configuration,"message",null);return null!==e&&"string"==typeof e&&(t.config.data={message:e}),t}function S(e){s&&DOMUtils.addClass(e,E.closeButtonVisible)}}(),PluginsHelper=function(){"use strict";var t,n,r,i=!1,o={},a={},c=!1,l=!1;return{setPreviewMode:function(e){i=e},isPreviewMode:function(){return i},setClientData:function(e){t=e},getClientData:function(){return t},setExperimentId:function(e){n=Number(e)},getExperimentId:function(){return n},setMatchedAudience:function(e){r=e},getMatchedAudience:function(){return r},setNotificationsOptions:function(e){ObjectUtil.isArray(e)&&(e={});o=e},getNotificationsOptions:function(){return o},setAccountOptions:function(e){ObjectUtil.isArray(e)&&(e={});a=e},getAccountOptions:function(){return a},setAcceleratedMode:function(e){c=!!e},getAcceleratedMode:function(){return c},setIsBrandingAdded:function(e){l=!!e},getIsBrandingAdded:function(){return l}}}(),PluginsManager=function(){"use strict";function e(){var g={DOM:"dom",DRAGNDROP:"dragndrop",CONTROLLER:"controller"},f={},r={},t=[".",",",":",";","?","!","(",")","[","]","{","}",'"'],d=[];return{registerCallback:function(e,t,n){f.hasOwnProperty(e)&&void 0!==f[e]||"function"==typeof t&&(f[e]=t,r[e]=n)},getPluginDefinition:p,countPluginsInstances:function(e){return e.querySelectorAll("span[data-plugin-id]").length},applyPlugin:o,reapplyPlugins:function(e){if(JSUtils.isFunction(e))for(var t=d.filter(e),n=0,r=t.length;n<r;n++){var i=t[n];o(i.name,i.element,i.configuration)}},requeuePlugin:function(e){o(e.name,null,e)},isPluginApplied:E,processTextNode:h,isPunctuationMark:s,createChild:function(){return new e},_plugins:f,_pluginsDefinition:r};function p(e){if(r.hasOwnProperty(e))return r[e]}function o(t,n,r){try{var e=p(t),i=r.hasOwnProperty("id")?r.id:null,o=n;if(!e)return;if(e.type===g.DRAGNDROP){var a='span[data-plugin-id="'+t+":"+i+'"]';if(!(o=n.querySelector(a)))return;e.hasOwnProperty("dropType")&&"text"===e.dropType&&h(o)}if(E(t,i)||d.push({name:t,id:i,element:n,configuration:r}),e.type===g.CONTROLLER)return;l=o,s=r,u=p(c=t),f.hasOwnProperty(c)&&void 0!==f[c]&&(l=f[c](l,s,function(){PluginsDisplay.setPluginReadyState(s)}),u.type!==g.DOM&&u.type!==g.CONTROLLER||PluginsDisplay.addPlugin(s,l))}catch(e){Logger.getLogger("PluginsHandler").log("Error applying plugin",e,t,n,r)}var c,l,s,u}function E(e,t){for(var n=0,r=d.length;n<r;n++)if(d[n].name===e&&d[n].id===t)return!0;return!1}function h(e){var t,n=e.parentNode,r=e.previousSibling,i=e.nextSibling,o=null,a=!1,c=!1,l=!1;null!==r&&(r.nodeType===Node.TEXT_NODE?s(t=(o=r.nodeValue).charAt(o.length-1))?l=!0:" "!==t&&(c=!0):r.nodeType===Node.ELEMENT_NODE&&(c=!0)),null!==i&&(i.nodeType===Node.TEXT_NODE?s(o=(o=i.nodeValue).charAt(0))||" "!==o&&(a=!0):i.nodeType===Node.ELEMENT_NODE&&(a=!0)),(l||c)&&n.insertBefore(document.createTextNode(" "),e),a&&n.insertBefore(document.createTextNode(" "),i)}function s(e){return 0<=t.indexOf(e)}}return new e}(),PluginsStack=function(){"use strict";var n=[];return{handle:function(){Logger.getLogger("PluginsHandler").log("Handling stacked plugins...",n),0<n.length&&function(){for(var e=0;e<n.length;e++){var t=n[e].configuration.name;PluginsManager.applyPlugin(t,n[e].element,n[e].configuration)}}()},addPlugin:function(e,t){n.push({element:t,configuration:e})},getPlugins:function(){return n}}}(),QueueManager=function(){var t={};return{getInstanceByName:function(e){return t[e]||(t[e]=new RequestQueue(e),t[e])},getQueueInstances:function(){return t},setQueueInstances:function(e){t=e}}}(),RequestQueue=function(e){var t=!1,n=[],r=Logger.getLogger("RequestQueue");return EventHandler.on(EVENTS.REQUEST_FAILSAFE,o),{addToQueue:function(e){n.push(e),r.log("Request added to the queue",e),t||i()},sendFirstRequestFromQueue:i,getName:function(){return e},getQueue:function(){return n},setQueue:function(e){n=e,t=!1},setPending:function(e){t=e}};function i(){var e=n.shift();e&&e.callback?(r.log("Processing item from the queue",e),t=!0,e.callback.apply(this,[e.data,o])):t=!1}function o(){r.log("Response received"),t=!1,i()}};function StateManager(e){"use strict";var t=e;return{getVariationState:function(e,t){if(!e)return STATE.NO_MATCHING;if(t.type===VARIATION_TYPE.SPLIT_URL)return STATE.SPLIT_URL;if(t.type===VARIATION_TYPE.AB)return function(e){if(!e.applicator_data)return!1;if(0===function(e){for(var t=[],n=0;n<e.plugins.length;n++){var r=e.plugins[n];!function(e){return e.type&&e.type===PLUGIN_TYPES.DOM}(r)||t.push(r.name)}return t}(e).length)return!1;var t=e.applicator_data,e=t.hasOwnProperty("decorators")&&0<t.decorators.length,n=t.hasOwnProperty("dom")?t.dom:[];if(e)return!1;for(var r=0,i=n.length;r<i;r++)if(n[r].selector!==APPLICATOR.DOM_PLUGIN_SELECTOR)return!1;return!0}(t)?STATE.DOM_PLUGINS:STATE.AB;if(t.type===VARIATION_TYPE.ORIGINAL)return STATE.ORIGINAL},hasBranding:function(){return t.branding},hidesPage:function(){return!t.hasOwnProperty("flags")||!t.flags.hasOwnProperty("hides_page")||t.flags.hides_page},hasPlugins:function(e){if(!e.applicator_data.plugins)return!1;var t=e.applicator_data.plugins;if(0===t.length)return!1;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(!i.configuration.hasOwnProperty("children"))return!0;if(0<i.configuration.children.length)return!0}return!1},hasActions:function(e){var t=e.applicator_data;if(!t)return!1;e=t.hasOwnProperty("decorators")&&0<t.decorators.length,t=t.hasOwnProperty("dom")&&0<t.dom.length;return e||t}}}function CookieStorage(o){"use strict";return{get:function(e,t){e=new RegExp("(?:(?:^|.*;)\\s*"+e+"\\s*\\=\\s*([^;]*).*$)|^.*$"),e=document.cookie.replace(e,"$1");if(!e||""===e)return null;if(t)return e;return Base64.decode(e)},put:function(e,t,n,r,i){StringUtils.isInteger(t)&&(t=""+t);var t=n?t:Base64.encode(t),e=e+"="+t+";";0<Number(o)&&(t=new Date,i?t.setTime(t.getTime()+60*o*1e3):t.setDate(t.getDate()+o),e+="expires="+t+";");e+=" path=/;",r&&(e+=" domain=."+r);document.cookie=e},remove:function(e){document.cookie=e+"=;expires="+(new Date).toUTCString()+";path=/"}}}var PersistentCookieStorage=function(){"use strict";return CookieStorage(1024)}(),PersistentStorage=function(){"use strict";return{getInstance:function(){return Storage(PersistentCookieStorage)}}}();function Storage(i){"use strict";var o="json:";return{get:function(e,t){t=i.get(e,t);if(t&&StringUtils.startsWith(t,o))try{t=JSON.parse(t.substring(o.length))}catch(e){}return t},put:function(e,t,n,r){"object"==typeof t&&(t=o+JSON.stringify(t));i.put(e,t,n,r)},remove:function(e){return i.remove(e)}}}var TransientCookieStorage=function(){"use strict";return CookieStorage()}(),TransientStorage=function(){"use strict";return{getInstance:function(){return Storage(TransientCookieStorage)}}}();function CollectApi(o){"use strict";var n=UrlService.getUrlByName(URLS.PIXEL_API),t="/convertize/v1/collect",i="/convertize/v1/error",a="io.convertize.collected",c=5e3,l=PersistentStorage.getInstance(),s=l.get(a,!0),u=Logger.getLogger("CollectApi");return{recordGoal:function(e,t,n){t=t||0;n||0===n||(n=-1);void 0===e.id&&(e.id=0);var r=e.id;if("string"==typeof r){r=r.split(",");for(var i=0;i<r.length;i++)r[i]=+r[i]}return d(f({eventtypeid:+e.type,eventid:r,project:+o,variation:+n,scenario:+t}),void 0,EVENTS.GOAL_RECORDED)},recordVariation:function(e,t){var n={eventtypeid:0,eventid:[0],project:+o,variation:+(t=t||{id:0}).id,scenario:+(e=e||{id:0}).id},r=f(n),n=p(e,EVENTS.PARTICIPATED,n),n=d(r,n,EVENTS.PARTICIPATED);return function(e,t){if(e.id&&e.integration_options)for(var n in IntegrationsTracker.enqueue(e,t),e.integration_options)IntegrationsTracker.capture(n)}(e,t),n},recordError:r};function r(e,t,n){var n={step:t,name:e.name,message:e.message,metadata:n=n||{}},r=g(i,n);return d(r,function(){u.log("Recording: FAILED",r)})}function g(e,t){return t.collected=null===s?null:decodeURIComponent(s),n+e+"?data="+encodeURIComponent(JSON.stringify(t))+"&time="+ +new Date}function f(e){return g(t,e)}function d(t,e,n){u.log("Recording...",t),"function"!=typeof e&&(e=p(t,n));var r=setTimeout(function(){EventHandler.broadcast(EVENTS.REQUEST_FAILSAFE)},c);return XHRUtil.get(t).promise.then(function(e){null!==e&&(s=e,l.put(a,encodeURIComponent(e),!0,WindowUtil.getTopLevelDomain()),function(e,t){try{var n=new URL("https:"+e),r=JSON.parse(n.searchParams.get("data"));r.collected=t,n.searchParams.set("data",JSON.stringify(r));var i=new Image;i.onerror=function(e){u.log("TrackWithImage: error",e)},i.onload=function(){u.log("TrackWithImage: OK")},i.src=n.toString()}catch(e){u.log("TrackWithImage: Failed",e)}}(t,s)),u.log("Recording: OK",t),n&&EventHandler.broadcast(n),clearTimeout(r)}).catch(e)}function p(e,t,n){return function(){try{u.log("Recording: FAILED",e),t&&EventHandler.broadcast(t),n=n||{},r({name:"RecordingError",message:"Event could not be recorded"},STEP.TRACK_VARIATION,n)}catch(e){console.error("CollectApi: ERROR",e)}}}}var IntegrationsTracker=function(){"use strict";var a,o="Convertize",c=[],l={mixpanel:function(e,t){window.mixpanel=window.mixpanel||[];var n={"Experiment Name":e.name,"Variation Name":t.name};"function"==typeof window.mixpanel.track?window.mixpanel.track(o,n):window.mixpanel.push(["track",o,n]),a.log("Sent variation to mixpanel",{experiment:e,variation:t})},ga:function(t,n){function r(){if(i++,window.ga&&"function"==typeof window.ga&&"function"==typeof window.ga.getAll){var e=window.ga.getAll()[0].get("name")+".send";return window.ga(e,{hitType:"event",eventCategory:"Variation",eventAction:o,eventLabel:t.name+" "+n.name}),void a.log("Sent variation to GA",{experiment:t,variation:n})}i<=5&&setTimeout(r,1e3)}var i=0;r()},gtm:function(e,t){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:o,type:"Variation",experiment:e.name,variation:t.name}),a.log("Sent variation to GTM ",{experiment:e,variation:t})},gtag:function(e,t){window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},window.gtag("event",o,{event_category:"Variation",event_label:e.name+" "+t.name,non_interactive:!0}),a.log("Sent variation to GTAG ",{experiment:e,variation:t})},glassbox:function(e,t){function n(){if(r++,window._detector&&"function"==typeof window._detector.triggerABTestingEvent)return window._detector.triggerABTestingEvent("convertize",e.id.toString(),e.name,t.id.toString(),t.name),void a.log("Sent variation to Glassbox ",{experiment:e,variation:t});r<=5&&setTimeout(n,1e3)}var r=0;n()}};return{enqueue:function(e,t){c.push({experiment:e,variation:t})},capture:function(e){if(a=Logger.getLogger("IntegrationsTracker"),e in l)for(var t=0;t<c.length;t++){var n=c[t].experiment,r=c[t].variation,i=n.integration_options;if(n.id&&i)for(var o in i)if(o===e&&!1!==i[o])try{l[o](n,r)}catch(e){a.log("Integration "+o+" error",e)}}},isValidIntegration:function(e){return e in l}}}();function VisitorTracker(n){"use strict";var r=QueueManager.getInstanceByName(QUEUE.REQUEST),i="io.convertize.participation",o=PersistentStorage.getInstance();return{isNewVisitor:function(){return null===o.get(i)},getParticipationForExperiment:function(e){var t=o.get(i);if(t)return t[e]},participateToExperiment:function(e,t){var n=o.get(i);n=n||{};r.addToQueue({callback:a,data:{experiment:e,variation:t}}),n[e.id]={variation_id:t.id},o.put(i,n,!1,WindowUtil.getTopLevelDomain())}};function a(e,t){n.recordVariation(e.experiment,e.variation),EventHandler.on(EVENTS.PARTICIPATED,function(){"function"==typeof t&&t()})}}var UrlService=function(){"use strict";var n={};return{setUrls:function(e){n=ObjectUtil.isObject(e)?e:{}},setUrlByName:function(e,t){n[e]=t},getUrls:function(){return n},getUrlByName:function(e){if(n.hasOwnProperty(e))return n[e];return!1},_urls:n}}(),Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,i,o,a,c="",l=0;for(e=Base64._utf8_encode(e);l<e.length;)r=(a=e.charCodeAt(l++))>>2,i=(3&a)<<4|(t=e.charCodeAt(l++))>>4,o=(15&t)<<2|(n=e.charCodeAt(l++))>>6,a=63&n,isNaN(t)?o=a=64:isNaN(n)&&(a=64),c=c+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(o)+this._keyStr.charAt(a);return c},decode:function(e){var t,n,r,i,o,a,c="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)r=this._keyStr.indexOf(e.charAt(l++)),t=(15&(i=this._keyStr.indexOf(e.charAt(l++))))<<4|(o=this._keyStr.indexOf(e.charAt(l++)))>>2,n=(3&o)<<6|(a=this._keyStr.indexOf(e.charAt(l++))),c+=String.fromCharCode(r<<2|i>>4),64!=o&&(c+=String.fromCharCode(t)),64!=a&&(c+=String.fromCharCode(n));return c=Base64._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t,n,r="",i=0,o=0;i<e.length;)(t=e.charCodeAt(i))<128?(r+=String.fromCharCode(t),i++):191<t&&t<224?(o=e.charCodeAt(i+1),r+=String.fromCharCode((31&t)<<6|63&o),i+=2):(o=e.charCodeAt(i+1),n=e.charCodeAt(i+2),r+=String.fromCharCode((15&t)<<12|(63&o)<<6|63&n),i+=3);return r},isBase64:function(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)}},BrowserHistoryListener=function(){"use strict";var e=!1;return{init:function(){var n,r;e||(e=!0,n=window.history.replaceState,window.history.replaceState=function(e){var t=n.apply(window.history,arguments);return EventHandler.broadcast(EVENTS.HISTORY_REPLACE_STATE,e),t},r=window.history.pushState,window.history.pushState=function(e){var t=r.apply(window.history,arguments);return EventHandler.broadcast(EVENTS.HISTORY_PUSH_STATE,e),t})}}}(),DomTreeReflectionUtil=function(){"use strict";var t=null,c=[],l=0;return{refreshReflection:function(){t=document.cloneNode(!0),c=[],l=0,function e(t,n){if(t.childNodes.length!==n.childNodes.length)return;for(var r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r],a=n.childNodes[r];c.push({node:o,reference:a}),l++,o.nodeType===Node.ELEMENT_NODE&&e(o,a)}}(document.body,t.body)},getNodeBySelector:function(e){return n(XPathUtil.getNodeByXPath(e,t))},getNodeFromReference:n};function n(e){if(!e)return!1;for(var t=0;t<l;t++){var n=c[t];if(n.reference===e)return n.node}return!1}}(),DOMUtils=function(){"use strict";return{addClass:function(e,t){n(e,t)||(e.className+=" "+t)},removeClass:function(e,t){n(e,t)&&(t=new RegExp("(\\s|^)"+t+"(\\s|$)"),e.className=e.className.replace(t," "))},hasClass:n,setNodeData:function(e,t,n){e.dataset?e.dataset[t]=n:e.setAttribute("data-"+t,n)},getNodeData:function(e,t){return e.dataset?!!e.dataset.hasOwnProperty(t)&&e.dataset[t]:e.getAttribute(t)},insertDynamicElement:function(e,t,n,r){n=document.createElement(n);n.setAttribute(APPLICATOR.DOM_ELEMENT_ACTION_ATTRIBUTE,e),i(n,t,r)},insertElement:i,addEventListener:function(e,t,n,r){WindowUtil.supportsEventListener()?e.addEventListener(t,n,r):e.attachEvent(t,n)},removeElement:function(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)}};function n(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function i(e,t,n){if(t&&t.parentNode)switch(n){case"before":t.parentNode.insertBefore(e,t);break;case"after":t.parentNode.lastChild===t?t.parentNode.appendChild(e):t.parentNode.insertBefore(e,t.nextSibling);break;case"prepend":t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e);break;case"append":t.appendChild(e)}}}(),JSUtils=function(){"use strict";return{isFunction:c,callCallback:function(e,t){return!!c(e)&&e.apply(null,t)},serializeObject:function(e){if(!ObjectUtil.isObject(e))return"";function t(e,t){r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}function a(e,t,n){if(Array.isArray(t))for(var r=0,i=t.length;r<i;++r)a(e+"[]",t[r],n);else if(t&&"object"==typeof t)for(var o in t)a(e+"["+o+"]",t[o],n);else c(t)||n(e,t)}var n,r=[];for(n in e)a(n,e[n],t);return r.join("&").replace(/%20/g,"+")}};function c(e){return!!(e&&e.constructor&&e.call&&e.apply)}}(),NodeSelectorUtil=function(){"use strict";return{getNodeBySelector:function(e){if(!e)return!1;if(r(e))return n(i(e));var t=DomTreeReflectionUtil.getNodeBySelector(e);return t||XPathUtil.getNodeByXPath(e)},getNodeByAction:n,isDynamicSelector:r,generateSelectorForAction:function(e){return!!e&&"["+e+"]"},extractActionFromDynamicSelector:i};function n(e){if(!e)return!1;e=document.querySelectorAll("["+APPLICATOR.DOM_ELEMENT_ACTION_ATTRIBUTE+'="'+e+'"]');return 0<e.length&&e[0]}function r(e){if(!e||0===e.length)return!1;var t=e.charAt(0),n=e.charAt(e.length-1);if("["!==t||"]"!==n)return!1;for(var r=1,i=e.length-1;r<i;r++){var o=e.charAt(r);if("-"!==o&&isNaN(Number(o)))return!1}return!0}function i(e){return e.substr(1,e.length-2)}}(),ObjectUtil=function(){"use strict";return{replaceProperty:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r,i=e[n];for(r in i)i.hasOwnProperty(r)&&r===t&&(i.variation_id=i[r],delete i[r])}return e},sortByKey:function(e){var t,n,r=[],i={};for(t in e)e.hasOwnProperty(t)&&r.push(t);for(n in r.sort(),r)e.hasOwnProperty(t)&&(t=r[n],i[t]=e[t]);return i},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},getObjectProperty:function(e,t,n){return e&&e.hasOwnProperty(t)?e[t]:n},extendObject:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}}}(),RegexUtil=function(){"use strict";var c=Logger.getLogger("RegexUtil");return{testUrl:function(e,t,n){try{var r=new RegExp(e.pattern);if(e.type===MATCH_TYPES.DOES_NOT_CONTAIN){var i=WindowUtil.getUrlUntouched(t,n);if(r.test(i))return!0}else{var o=WindowUtil.getUrlWithoutTrailingSlash(t,n),a=WindowUtil.getUrlWithTrailingSlash(t,n);if(r.test(o)||r.test(a))return!0}return!1}catch(e){c.log("Error: ",e)}}}}(),StringUtils=function(){"use strict";return{startsWith:r,removeFromString:function(e,t,n){{if(n!==STRING_POSITION.BEGINNING)return t.replace(e,"");if(r(t,e))return t.substr(e.length)}},removeTrailingSlashFromUrl:function(e){if(e&&-1!==e.indexOf("?"))return e.replace("/?","?");if(e&&"/"===e.slice(-1))return e.slice(0,-1);return e},isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},isString:i,rtrim:function(e,t){i(e)||(e+="");for(var n=e.length-1;0<=n;n--)if(t!=e.charAt(n)){e=e.substring(0,n+1);break}return e},toLowercase:function(e){return e.toLowerCase()}};function r(e,t,n){return e.substr(n=n||0,t.length)===t}function i(e){return"string"==typeof e||e instanceof String}}(),WindowUtil=function(){"use strict";var o={alert:function(e){return window.alert(e)},getLocationSearch:function(){return window.location.search},getLocationOrigin:s,getLocationPathname:u,getActualLocationHref:function(){return window.location.href},getLocationHref:function(){return e(o.getActualLocationHref())},setLocationHref:function(e){window.location.href=e},reloadLocation:function(){window.location.reload()},replaceHistory:function(e){return window.history.replaceState&&window.history.replaceState({},"redirect",e)},getQueryParameters:g,getDocumentReferrer:function(){return document.referrer},getTopLevelDomain:function(){for(var e,t="get_top_level_domain=cookie",n=document.location.hostname.split("."),r=n.length-1;0<=r;r--)if(e=n.slice(r).join("."),document.cookie=t+";domain=."+e+";",-1<document.cookie.indexOf(t))return document.cookie=t.split("=")[0]+"=;domain=."+e+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",e},loadStyle:function(e){var t=document.createElement("style");t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e));document.getElementsByTagName("head")[0].appendChild(t)},showPage:function(){var e=document.getElementsByTagName("html")[0];e&&e.style&&(e.style.visibility="")},hidePage:function(){var e=document.getElementsByTagName("html")[0];e&&e.style&&(e.style.visibility="hidden")},supportsEventListener:function(){return!!window.addEventListener},addEventListener:function(e,t){window.addEventListener(e,t,!1)},supportsAttachEvent:function(){return!!window.attachEvent},attachEvent:function(e,t){window.attachEvent(e,t)},supportsOnLoadEvent:function(){return!!window.onLoad},onLoad:function(e){window.onload=e},isDocumentReady:function(){return"complete"===document.readyState},getWindowUrl:function(e){var t=s(),n=u(),r=g(),i="";e=e||[];for(var o,a=0;a<e.length;a++)r.hasOwnProperty(e[a])&&delete r[e[a]];if(0===r.length)return[t,n].join("");for(o in r=ObjectUtil.sortByKey(r)){var c,l;r.hasOwnProperty(o)&&(c=r[o],l=0===i.length?"":"&",i+=l+o+"="+encodeURIComponent(c))}0<i.length&&(i="?"+i);return[t,n,i].join("")},getHost:function(){return window.location.host},getCleanPathname:function(){return e(window.location.pathname)},getProtocol:function(){return window.location.protocol},getTopWindow:function(){return window.top},getUrlWithoutTrailingSlash:function(e,t){return i(r(n()),e,t)},getUrlWithTrailingSlash:function(e,t){return i(r(n()+"/"),e,t)},getUrlUntouched:function(e,t){var n=o.getActualLocationHref();e&&(n=StringUtils.removeFromString(t,n,STRING_POSITION.BEGINNING));return n}};return o;function s(){return window.location.origin}function u(){return window.location.pathname}function g(e){if(""===(t=e||o.getLocationSearch()))return{};for(var t=t.substring(1).split("&"),n={},r=0;r<t.length;++r){var i=t[r].split("=");1===i.length?n[i[0]]=null:2===i.length&&(n[i[0]]=decodeURIComponent(i[1].replace(/\+/g," ")))}return n}function e(e){return e&&"/"===e.slice(-1)?e.slice(0,-1):e}function n(){var e=WindowUtil.getProtocol()+"//"+WindowUtil.getHost(),t=WindowUtil.getCleanPathname();return void 0!==t&&(e+=t),e}function r(e){var t=WindowUtil.getLocationSearch();return void 0!==t&&(e+=t),e}function i(e,t,n){return e=t?StringUtils.removeFromString(n,e,STRING_POSITION.BEGINNING):e}}(),XHRUtil=function(){"use strict";var c=void 0!==XMLHttpRequest.DONE?XMLHttpRequest.DONE:4,l=!0;return{post:function(e,t,n){return r("POST",e,t,n||"form")},get:function(e,t){t=JSUtils.serializeObject(t);t&&(e+="?"+t);return r("GET",e,{})},send:r,isDone:function(e){return e&&e.readyState===c}};function r(e,r,i,o){var a=new XMLHttpRequest,t=new Promise(function(t,n){switch(a.open(e,r,!0),a.withCredentials=!0,o||"form"){case"form":ObjectUtil.isEmptyObject(i)||a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i=JSUtils.serializeObject(i);break;case"json":"POST"!==e||l?a.setRequestHeader("Content-type","text/plain"):a.setRequestHeader("Content-Type","application/json"),i=JSON.stringify(i)}a.onreadystatechange=function(){var e;a.readyState===c&&(200<=a.status&&a.status<400?null!==a.responseText&&""!==a.responseText?(e=JSON.parse(a.responseText),t(e)):t(null):n())},a.onerror=function(){n()},a.send(i)});return{request:a,promise:t}}}(),XPathUtil=function(){"use strict";return{getNodeByXPath:function(e,t){if(e)for(var n,r=e.split("||"),i=0;i<r.length;i++)if(n=function(e,t){t=t||document;{if(t.evaluate)return t.evaluate(e,t,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null).snapshotItem(0);e=e.replace(".//","").replace(/^\//,"").replace(/^\/\*\[\@id=\'(.+)\'\]/,"#$1").replace(/^\/\*\[\@id=\"(.+)\"\]/,"#$1").replace(/\//g," > ").replace(/\[([0-9]+)\]/g,function(e,t){return":nth-of-type("+parseInt(t,10)+")"});return t.querySelector(e)}}(r[i],t))return n}}}();function VariationAbApplicator(t){"use strict";var n,r,i,o,a,c;return{apply:function(e){l(e)&&(n=e.decorators,r=e.dom,c=Logger.getLogger("VariationAbApplicator"),a=VariationApplicatorHelper(),i=VariationDecoratorsApplicator(a),o=VariationDomApplicator(a,i,t),a.setPlugins(e.plugins),c.log("Applying modifications",e),DomTreeReflectionUtil.refreshReflection(),i.processDecorators(n),o.processModifications(r),EventHandler.broadcast(EVENTS.VARIATION_APPLIED))},_isValidApplicatorData:l};function l(e){return"object"==typeof e&&(!(!e.hasOwnProperty("plugins")||!ObjectUtil.isArray(e.plugins))&&(!(!e.hasOwnProperty("decorators")||!ObjectUtil.isArray(e.decorators))&&!(!e.hasOwnProperty("dom")||!ObjectUtil.isArray(e.dom))))}}function VariationDecoratorsApplicator(l){"use strict";var s,u=[],i={};return{processDecorators:function(e){if(e&&0!==e.length){s=Logger.getLogger("VariationDecoratorsApplicator");for(var t=0,n=e.length;t<n;t++){var r=e[t];NodeSelectorUtil.isDynamicSelector(r.selector)?i[r.selector]=r:o(r)}s.log("Applying Decorators Finished")}},applyDynamicDecorator:function(e){e=function(e){if(e=NodeSelectorUtil.generateSelectorForAction(e),i.hasOwnProperty(e))return i[e];return!1}(e);e&&(o(e),function(){for(var e=u.slice(0),t=0,n=e.length;t<n;t++)o(e[t],!0)}())}};function o(e,t){var n,r,i,o,a,c;e&&(i=e.selector,e.selector==GLOBAL_OPTIONS_VAR.CSS_NODE_SELECTOR?i=GLOBAL_OPTIONS_VAR.CSS_NODE:e.selector==GLOBAL_OPTIONS_VAR.JS_NODE_SELECTOR&&(i=GLOBAL_OPTIONS_VAR.JS_NODE),(n=NodeSelectorUtil.getNodeBySelector(i))?(r=n,null!==(i=e.content)&&(r.innerHTML=i),function(e,t){if(t)for(var n=0,r=t.length;n<r;n++){var i=t[n],o=i[0],a=i[1],i=l.getPluginConfiguration(o,a),a=PluginsManager.getPluginDefinition(o);if(void 0===i)return s.log("Applying: FAILED: Could not find Plugin configuration",o);if(void 0===a||a.type!==PLUGIN_TYPES.DRAGNDROP)return s.log("Applying: FAILED: Plugin type not supported",o);PluginsStack.addPlugin(i,e)}}(n,e.plugins),e.selector==GLOBAL_OPTIONS_VAR.CSS_NODE_SELECTOR?(o=n,a=e.css,c=a[0],(a=o.querySelector("#"+GLOBAL_OPTIONS_VAR.CSS_NODE_ID))?a.innerHTML=c:((a=document.createElement("style")).type="text/css",a.setAttribute("id",GLOBAL_OPTIONS_VAR.CSS_NODE_ID),a.appendChild(document.createTextNode(c)),o.appendChild(a))):e.selector==GLOBAL_OPTIONS_VAR.JS_NODE_SELECTOR?(c=n,o=e.js,a=o[0],(o=c.querySelector("#"+GLOBAL_OPTIONS_VAR.JS_NODE_ID))?o.innerHTML=a:((o=document.createElement("script")).type="text/javascript",o.setAttribute("id",GLOBAL_OPTIONS_VAR.JS_NODE_ID),o.appendChild(document.createTextNode(a)),c.appendChild(o))):function(e,t){if(t){var n,r,i="";for(n in t)t.hasOwnProperty(n)&&(0<=(r=t[n]).indexOf("!important")&&(r=r.replace(" !important","").replace("!important","")),e.style.setProperty?e.style.setProperty(n,r,"important"):document.all&&(i+=n+":"+r+" !important;"));document.all&&0<i.length&&e.style.setAttribute("cssText",i)}}(n,e.css),function(e,t){if(t)for(var n in t){var r;t.hasOwnProperty(n)&&((r=t[n])===APPLICATOR.REMOVED_PLUGIN_PLACEHOLDER?e.removeAttribute(n):e.setAttribute(n,r))}}(n,e.attributes),function(e){e=u.indexOf(e);0<=e&&u.slice(e,1)}(e)):t||u.push(e))}}function VariationDomApplicator(c,i,l){"use strict";var s,u=100;return{processModifications:function(e){if(e){s=Logger.getLogger("VariationDomApplicator");for(var t=0,n=e.length;t<n;t++){var r=e[t];switch(r.action){case DOM_ACTIONS.INSERT:!function(e){var t,n=NodeSelectorUtil.getNodeBySelector(e.selector);n&&(t=e.data,DOMUtils.insertDynamicElement(e.id,n,t.tag,t.position),i.applyDynamicDecorator(e.id))}(r);break;case DOM_ACTIONS.PLUGIN:!function(e){var t=e.data.name,e=e.data.id;!function(e,t,n){var r=PluginsManager.getPluginDefinition(e);n=n||c.getPluginConfiguration(e,t);if(n&&r){if(r.type&&r.type===PLUGIN_TYPES.CONTROLLER){if(!n.children)return;for(var i=0,o=n.children.length;i<o;i++){var a=n.children[i];a.hasOwnProperty("status")&&!a.status||(a.configId=a.id,a.id=u++,PluginsManager.applyPlugin(a.name,null,a),function(e){return e.hasVariables||!1}(a)&&l.processPlugin(e,a))}}PluginsManager.applyPlugin(e,null,n),"undefined"!=typeof pluginsDataProvider&&"flushSocialProof"in pluginsDataProvider&&pluginsDataProvider.flushSocialProof()}else s.log("Applying: "+e+": FAILED: Plugin configuration not found")}(t,e)}(r);break;case DOM_ACTIONS.REARRANGE:!function(e){var t=NodeSelectorUtil.getNodeBySelector(e.selector),n=NodeSelectorUtil.getNodeBySelector(e.data.target);n&&DOMUtils.insertElement(t,n,e.data.position)}(r)}}s.log("Applying DOM Finished")}}}}function VariationApplicatorHelper(){var o=[];return{setPlugins:function(e){o=e},getPluginConfiguration:function(e,t){if(!o)return!1;for(var n=0,r=o.length;n<r;n++){var i=o[n];if(i.name===e&&i.id===t)return i.configuration.name=e,i.configuration.id=t,i.configuration}return!1}}}function VariationSplitApplicator(n){"use strict";var r=Logger.getLogger("VariationSplitApplicator"),i=UrlService.getUrlByName(URLS.PROXY_PREVIEW);return{apply:function(e){var t=e.target_pattern;if(t=e.include_live_query_parameters?o(t):t,r.log("Redirecting...",t),n)WindowUtil.setLocationHref(i+t);else{try{WindowUtil.replaceHistory(t)}catch(e){r.log("Redirecting: Could not replace history",e)}WindowUtil.setLocationHref(t)}},isOnTargetPage:function(e){var t=StringUtils.removeTrailingSlashFromUrl(e.target_pattern).split("?"),e=StringUtils.removeTrailingSlashFromUrl(WindowUtil.getLocationHref()).split("?");if(n&&-1===e[0].indexOf(t[0]))return!1;return!(!n&&t[0]!==e[0])&&function(e,t){if(!e[1])return!0;if(e[1]&&!t[1])return!1;for(var n=e[1].split("&"),r=t[1].split("&"),i=0;i<n.length;i++)if(-1===r.indexOf(n[i]))return!1;return!0}(t,e)}};function o(e){var t=e.split("?");return t&&t[1]?WindowUtil.getLocationSearch()?t[0]+"?"+t[1]+"&"+WindowUtil.getLocationSearch().substring(1):e:e+WindowUtil.getLocationSearch()}}function PixelController(r,n,t,e,i){var o,a,c,l,s,u,g,f,d=n.isPreview;void 0!==e&&!d||(e=!1),PluginsHelper.setPreviewMode(d),r&&void 0!==r.account_settings&&AccountOptions.setOptions(r.account_settings);var p=VariationAbApplicator(i),E=VariationSplitApplicator(d);return Logger.setDebug(e),Logger.getLogger("ConvertizePixel").log("Initialising Pixel"),WindowUtil.supportsEventListener()?WindowUtil.addEventListener("load",function(){EventHandler.broadcast(EVENTS.PAGE_LOAD)}):WindowUtil.supportsAttachEvent()?WindowUtil.attachEvent("onload",function(){EventHandler.broadcast(EVENTS.PAGE_LOAD)}):WindowUtil.supportsOnLoadEvent()&&WindowUtil.onLoad(function(){EventHandler.broadcast(EVENTS.PAGE_LOAD)}),function(){var e=!1,t=!1;EventHandler.on(EVENTS.GOALS_RECORDED,function(){h(t=!0,e)}),EventHandler.on(EVENTS.PARTICIPATED,function(){h(t,e=!0)})}(),function(){var e=5,t=function(){document.body?EventHandler.broadcast(EVENTS.BODY_AVAILABLE):e<1||(e--,setTimeout(t,10))};setTimeout(t,0)}(),PixelApi(i),{getExperiment:function(){return o=r.project,a=r.experiments,v(),s=ClientData(RawClientData),u=AudienceTargeter([n.getClass(CookieMatcher(),!1),n.getClass(DeviceMatcher(s),!1),n.getClass(IpMatcher(s),!1),n.getClass(LanguageMatcher(s),!1),n.getClass(LocationMatcher(s),!1),n.getClass(QueryMatcher(),!1),n.getClass(ReferralMatcher(),!1),n.getClass(ScheduleMatcher(),!1),n.getClass(UrlMatcher(d)),n.getClass(VisitorMatcher(l),!1)]),ExperimentPicker(u,l).pick(a)},getVariation:function(e){return VariationPicker(l).pick(e)},drawBranding:function(){var e=Branding(UrlService.getUrlByName(URLS.MEDIA),t);EventHandler.on(EVENTS.PAGE_LOAD,e.draw)},isOnTargetPage:function(e){return E.isOnTargetPage(e)},participateToExperiment:function(t,n){try{l?l.participateToExperiment(t,n):EventHandler.broadcast(EVENTS.PARTICIPATED)}catch(e){c.recordError(e,STEP.TRACK_VARIATION,{experiment:t,variation:n})}},applyVariation:function(t){try{p.apply(t.applicator_data)}catch(e){c.recordError(e,STEP.VARIATION_APPLIED,t)}},applySplitVariation:function(e){E.apply(e)},setPluginData:function(e){var t=UrlService.getUrlByName(URLS.PIXEL_API),n=StringUtils.rtrim(t,"/")+"/",t=AccountOptions.getOptions();PluginsApi.setBaseUrl(n),PluginsApi.setPlatform(PLATFORM.APP),PluginsHelper.setClientData(s),function(){var e=UrlService.getUrlByName("landingPageUrl"),t="_blank",t="Verified by <a href='"+e+"' target='"+t+"'>Convertize</a>";PixelInfo.setStandardBrandingText(t),PixelInfo.setCustomBrandingText(t)}(),e&&e.hasOwnProperty("id")&&PluginsHelper.setExperimentId(e.id);e&&e.hasOwnProperty("notifications_options")&&PluginsHelper.setNotificationsOptions(e.notifications_options);e&&e.hasOwnProperty("notifications_options")&&e.notifications_options.accelerated_mode&&PluginsHelper.setAcceleratedMode(!0);r&&r.branding&&PluginsHelper.setIsBrandingAdded(!0);ObjectUtil.isEmptyObject(t)||PluginsHelper.setAccountOptions(t);PluginsData.registerProvider(PluginsPreviewDataProvider),PluginsDisplay.prepareOptions()},handlePluginStack:function(){PluginsStack.handle()},recordPageViewGoals:function(){v(),g=n.getClass(GoalRecorder(c),PreviewGoalRecorder());try{PageViewGoalHandler(a,g,d).handle()}catch(e){c.recordError(e,STEP.TRACK_PAGE_VIEWS)}},initClickGoals:function(e,t){(g=n.getClass(GoalRecorder(c),PreviewGoalRecorder())).setExperiment(e),g.setVariation(t),(f=ClickGoalHandler(e,g,c,d,t)).init()},processUserGoals:function(){i.processUserGoals()},handleClickGoals:function(){f.handle()},handleAsyncPageLoad:function(){"complete"===document.readyState&&EventHandler.broadcast(EVENTS.PAGE_LOAD)},hidePage:function(){WindowUtil.hidePage()},addFailsafe:function(){EventHandler.on(EVENTS.FAILSAFE,A),setTimeout(function(){EventHandler.broadcast(EVENTS.FAILSAFE)},5e3)},showPage:A,recordError:function(e,t,n){n=n||{};c.recordError(e,t,n)}};function h(e,t){e&&t&&EventHandler.broadcast(EVENTS.API_RESPONSE)}function v(){l||(c=CollectApi(o),l=n.getClass(VisitorTracker(c),!1))}function A(e){WindowUtil.showPage(),e&&PluginsDisplay.showPlugins()}}function ConvertizePixel(r,i,o,e){"use strict";UrlService.setUrls(e);var a,c,l,s=ModeDecorator(),u=StateManager(r),g=ApiEventsProcessor(s,PersuasiveNotificationsEventProcessor,GoalEventProcessor),e=STATE.EXPERIMENTS,f={};function d(e,t){a.showPage(),console.error("[Convertize Pixel] Error",e),a.recordError(e,t)}f[STATE.EXPERIMENTS]=function(){c=STEP.INITIALISATION,a=PixelController(r,s,i,o,g),l=Logger.getLogger("StateManager");try{u.hidesPage()&&a.hidePage(),a.addFailsafe(),c=STEP.BRANDING,u.hasBranding()&&a.drawBranding(),c=STEP.PICK_EXPERIMENT;var e=a.getExperiment();c=STEP.PICK_VARIATION;var t=a.getVariation(e),n=u.getVariationState(e,t);f[n](e,t)}catch(e){d(e,c)}},f[STATE.NO_MATCHING]=function(){try{l.log(STATE.NO_MATCHING),c=STEP.NO_MATCHING,a.showPage(),a.recordPageViewGoals(),a.processUserGoals()}catch(e){d(e,c)}},f[STATE.ORIGINAL]=function(e,t){try{l.log(STATE.ORIGINAL),c=STEP.ORIGINAL,a.showPage(),a.participateToExperiment(e,t),a.recordPageViewGoals(),EventHandler.on(EVENTS.PAGE_LOAD,function(){a.initClickGoals(e,t),a.handleClickGoals(),a.processUserGoals()}),a.handleAsyncPageLoad()}catch(e){d(e,c)}},f[STATE.SPLIT_URL]=function(e,t){try{l.log(STATE.SPLIT_URL),c=STEP.SPLIT_URL,a.isOnTargetPage(t)?(a.showPage(),EventHandler.on(EVENTS.PAGE_LOAD,function(){a.initClickGoals(e,t),a.processUserGoals(),a.handleClickGoals()}),a.handleAsyncPageLoad()):(EventHandler.on(EVENTS.API_RESPONSE,n),EventHandler.on(EVENTS.FAILSAFE,n)),a.participateToExperiment(e,t),a.recordPageViewGoals()}catch(e){d(e,c)}function n(){a.applySplitVariation(t)}},f[STATE.AB]=function(t,n){var r=u.hasPlugins(n);try{l.log(STATE.AB),c=STEP.AB,u.hasActions(n)||a.showPage(),r&&a.setPluginData(t),EventHandler.on(EVENTS.PAGE_LOAD,function(){c=STEP.PAGE_LOAD,a.initClickGoals(t,n),a.applyVariation(n)}),EventHandler.on(EVENTS.VARIATION_APPLIED,function(){var e=!1;c=STEP.VARIATION_APPLIED,r&&(a.handlePluginStack(),e=!0);a.handleClickGoals(),a.showPage(e),a.participateToExperiment(t,n),a.recordPageViewGoals(),a.processUserGoals()}),a.handleAsyncPageLoad()}catch(e){d(e,c)}},f[STATE.DOM_PLUGINS]=function(e,t){try{l.log(STATE.DOM_PLUGINS),c=STEP.DOM_PLUGINS,EventHandler.on(EVENTS.PAGE_LOAD,function(){c=STEP.PAGE_LOAD,a.initClickGoals(e,t),a.handleClickGoals(),a.participateToExperiment(e,t),a.recordPageViewGoals(),a.processUserGoals()}),EventHandler.on(EVENTS.BODY_AVAILABLE,function(){c=STEP.BODY_AVAILABLE,a.applyVariation(t),a.handlePluginStack()}),a.setPluginData(e),a.handleAsyncPageLoad(),a.showPage(!0)}catch(e){d(e,c)}},f[e]()}var PluginsPreviewDataProvider=function(){return{getMoneyFormat:function(){return"£{{amount}}"}}};(function(WindowUtil){})(WindowUtil);var data={"branding":false,"project":10303,"experiments":{"21003":{"name":"GBS A\/B testing 1","id":21003,"url":"https:\/\/www.gameloft.com\/business-solutions\/","url_targeting":{"rules":[{"type":"CONTAINS","input":"\/business-solutions\/","pattern":"\\\/business\\-solutions\\\/"}],"examples":[]},"notifications_options":[],"is_legacy":false,"targeting":{"device":[],"language":[],"geo-location":[],"time":[],"cookie":[],"referrer":[],"visit":[],"url-query-parameters":[],"ip":[]},"goals":[{"id":17350,"name":"Request demo button","type":"CLICK","selector":"\/html\/body\/div[2]\/section\/div\/div\/div\/a[2]","dynamic":false,"options":null},{"id":17351,"name":"Homepage Pageview","type":"PAGE_VIEW","selector":"","dynamic":false,"options":{"type":"IS","input":"https:\/\/www.gameloft.com\/business-solutions\/?minh-rapper=1","pattern":"^https:\\\/\\\/www\\.gameloft\\.com\\\/business\\-solutions\\\/\\?minh\\-rapper=1$"}},{"id":17816,"name":"Subcat Page views","type":"PAGE_VIEW","selector":"","dynamic":false,"options":{"type":"PATTERN","input":"\/business-solutions\/?minh-rapper=1\/(.*)","pattern":"\/business-solutions\/?minh-rapper=1\/(.*)"}},{"id":17839,"name":"For Carriers Btn Click","type":"CLICK","selector":"\/\/*[@id=\"load-menu\"]\/nav\/div\/div[2]\/ul\/li\/a||\/html\/body\/header\/nav\/div\/div[2]\/ul\/li\/a","dynamic":false,"options":null},{"id":17840,"name":"For OEMs Btn Click","type":"CLICK","selector":"\/\/*[@id=\"load-menu\"]\/nav\/div\/div[2]\/ul\/li[2]\/a||\/html\/body\/header\/nav\/div\/div[2]\/ul\/li[2]\/a","dynamic":false,"options":null},{"id":17852,"name":"Case Studies Btn Click","type":"CLICK","selector":"\/\/*[@id=\"load-menu\"]\/nav\/div\/div[2]\/ul\/li[3]\/a||\/html\/body\/header\/nav\/div\/div[2]\/ul\/li[3]\/a","dynamic":false,"options":null},{"id":17853,"name":"Games Catalogue Btn","type":"CLICK","selector":"\/\/*[@id=\"load-menu\"]\/nav\/div\/div[2]\/ul\/li[4]\/a||\/html\/body\/header\/nav\/div\/div[2]\/ul\/li[4]\/a","dynamic":false,"options":null},{"id":17854,"name":"FAQ Btn click","type":"CLICK","selector":"\/\/*[@id=\"load-menu\"]\/nav\/div\/div[2]\/ul\/li[5]\/a||\/html\/body\/header\/nav\/div\/div[2]\/ul\/li[5]\/a","dynamic":false,"options":null},{"id":17855,"name":"Contact us Btn Click","type":"CLICK","selector":"\/\/*[@id=\"load-menu\"]\/nav\/div\/div[2]\/ul\/li[6]\/a||\/html\/body\/header\/nav\/div\/div[2]\/ul\/li[6]\/a","dynamic":false,"options":null}],"integration_options":{"ga":true,"gtm":true,"gtag":false,"glassbox":false,"mixpanel":false},"editor_options":[],"variations":[{"id":26708,"name":"Scenario 1: Banner static background","type":"AB","history_position":6,"scenario_id":21003,"traffic":5,"active":true,"tactic_id":null,"tactic_number":null,"applicator_data":{"plugins":[],"decorators":[{"selector":"\/html\/body\/div[2]\/section\/div\/div\/div\/a","content":null,"css":{"display":"none"},"js":[],"attributes":[],"plugins":[]},{"selector":"\/html\/body\/div[2]\/section\/div","content":null,"css":{"background-color":"#000000","background-image":"url(http:\/\/main.assets.gameloft.com\/assets\/gaming-business\/gbs\/gbs-ab-banner.jpg)","background-size":"cover","background-position":"center"},"js":[],"attributes":[],"plugins":[]}],"dom":[]},"history_position_limit":6,"plugins":[],"allocation":5,"target_example":null,"target_pattern":null,"include_live_query_parameters":false}]}},"flags":[],"account_settings":{"notifications_branding_disabled":true}},version="7.33.1";var urls={appUrl:"https://app.convertize.io",proxyPreviewUrl:null,pixelApiUrl:"//cp.convertize.io",mediaUrl:"https://s3-eu-west-1.amazonaws.com/scenario-prd/assets/",landingPageUrl:"https://www.convertize.io"};var debug=false;ConvertizePixel(data,version,debug,urls);})();